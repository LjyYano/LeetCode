---
title: å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨
date: 2024-02-09
---

## é¢˜ç›®æè¿°

**ğŸ”— é¢˜ç›®**ï¼š[å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨](https://leetcode.cn/problems/copy-list-with-random-pointer/)  
**ğŸ·ï¸ æ ‡ç­¾**ï¼š`å“ˆå¸Œè¡¨` `é“¾è¡¨`  
**ğŸŸ¡ éš¾åº¦**ï¼š`ä¸­ç­‰`  

ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º n çš„é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé¢å¤–å¢åŠ çš„éšæœºæŒ‡é’ˆ random ï¼Œè¯¥æŒ‡é’ˆå¯ä»¥æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»ä½•èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ã€‚æ„é€ è¿™ä¸ªé“¾è¡¨çš„ æ·±æ‹·è´ã€‚

æ·±æ‹·è´åº”è¯¥æ­£å¥½ç”± n ä¸ª å…¨æ–° èŠ‚ç‚¹ç»„æˆï¼Œå…¶ä¸­æ¯ä¸ªæ–°èŠ‚ç‚¹çš„å€¼éƒ½è®¾ä¸ºå…¶å¯¹åº”çš„åŸèŠ‚ç‚¹çš„å€¼ã€‚æ–°èŠ‚ç‚¹çš„ next æŒ‡é’ˆå’Œ random æŒ‡é’ˆä¹Ÿéƒ½åº”æŒ‡å‘å¤åˆ¶é“¾è¡¨ä¸­çš„æ–°èŠ‚ç‚¹ï¼Œå¹¶ä½¿åŸé“¾è¡¨å’Œå¤åˆ¶é“¾è¡¨ä¸­çš„è¿™äº›æŒ‡é’ˆèƒ½å¤Ÿè¡¨ç¤ºç›¸åŒçš„é“¾è¡¨çŠ¶æ€ã€‚å¤åˆ¶é“¾è¡¨ä¸­çš„æŒ‡é’ˆéƒ½ä¸åº”æŒ‡å‘åŸé“¾è¡¨ä¸­çš„èŠ‚ç‚¹ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœåŸé“¾è¡¨ä¸­æœ‰ X å’Œ Y ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä¸­ X.random --> Y ã€‚é‚£ä¹ˆåœ¨å¤åˆ¶é“¾è¡¨ä¸­å¯¹åº”çš„ä¸¤ä¸ªèŠ‚ç‚¹ x å’Œ y ï¼ŒåŒæ ·æœ‰ x.random --> y ã€‚

è¿”å›å¤åˆ¶é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚

ç”¨ä¸€ä¸ªç”± n ä¸ªèŠ‚ç‚¹ç»„æˆçš„é“¾è¡¨æ¥è¡¨ç¤ºè¾“å…¥/è¾“å‡ºä¸­çš„é“¾è¡¨ã€‚æ¯ä¸ªèŠ‚ç‚¹ç”¨ä¸€ä¸ª [val, random_index] è¡¨ç¤ºï¼š
- valï¼šä¸€ä¸ªè¡¨ç¤º Node.val çš„æ•´æ•°ã€‚
- random_indexï¼šéšæœºæŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹ç´¢å¼•ï¼ˆèŒƒå›´ä» 0 åˆ° n-1ï¼‰ï¼›å¦‚æœä¸æŒ‡å‘ä»»ä½•èŠ‚ç‚¹ï¼Œåˆ™ä¸º null ã€‚

ä½ çš„ä»£ç  åª æ¥å—åŸé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ä½œä¸ºä¼ å…¥å‚æ•°ã€‚

**ç¤ºä¾‹ 1ï¼š**
```
è¾“å…¥ï¼šhead = [[7,null],[13,0],[11,4],[10,2],[1,0]]
è¾“å‡ºï¼š[[7,null],[13,0],[11,4],[10,2],[1,0]]
```

**ç¤ºä¾‹ 2ï¼š**
```
è¾“å…¥ï¼šhead = [[1,1],[2,1]]
è¾“å‡ºï¼š[[1,1],[2,1]]
```

**ç¤ºä¾‹ 3ï¼š**
```
è¾“å…¥ï¼šhead = [[3,null],[3,0],[3,null]]
è¾“å‡ºï¼š[[3,null],[3,0],[3,null]]
```

**æç¤ºï¼š**
- 0 <= n <= 1000
- -10^4 <= Node.val <= 10^4
- Node.random ä¸º null æˆ–æŒ‡å‘é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ã€‚

---

## è§£é¢˜æ€è·¯

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å“ˆå¸Œè¡¨

#### ğŸ“ æ ¸å¿ƒæ€æƒ³

è¿™é“é¢˜çš„éš¾ç‚¹åœ¨äºå¦‚ä½•å¤„ç†éšæœºæŒ‡é’ˆã€‚å¦‚æœåªæ˜¯æ™®é€šçš„é“¾è¡¨ï¼ˆåªæœ‰ next æŒ‡é’ˆï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥éå†ä¸€æ¬¡å°±å®Œæˆå¤åˆ¶ã€‚ä½†æ˜¯ç”±äºå­˜åœ¨ random æŒ‡é’ˆï¼Œè€Œä¸”è¿™ä¸ªæŒ‡é’ˆå¯èƒ½æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»ä½•èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥è®°å½•åŸèŠ‚ç‚¹å’Œæ–°èŠ‚ç‚¹ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚

ä½¿ç”¨å“ˆå¸Œè¡¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼š
1. å“ˆå¸Œè¡¨çš„é”®æ˜¯åŸé“¾è¡¨ä¸­çš„èŠ‚ç‚¹
2. å“ˆå¸Œè¡¨çš„å€¼æ˜¯å¤åˆ¶é“¾è¡¨ä¸­å¯¹åº”çš„æ–°èŠ‚ç‚¹
3. è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨è®¾ç½® random æŒ‡é’ˆæ—¶ï¼Œå¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„æ–°èŠ‚ç‚¹

#### ğŸ› ï¸ å®ç°æ­¥éª¤

1. åˆ›å»ºå“ˆå¸Œè¡¨ï¼Œç”¨äºå­˜å‚¨åŸèŠ‚ç‚¹åˆ°æ–°èŠ‚ç‚¹çš„æ˜ å°„
2. ç¬¬ä¸€æ¬¡éå†ï¼š
   - åˆ›å»ºæ‰€æœ‰æ–°èŠ‚ç‚¹
   - å°†åŸèŠ‚ç‚¹å’Œæ–°èŠ‚ç‚¹çš„å¯¹åº”å…³ç³»å­˜å…¥å“ˆå¸Œè¡¨
3. ç¬¬äºŒæ¬¡éå†ï¼š
   - è®¾ç½®æ–°èŠ‚ç‚¹çš„ next æŒ‡é’ˆ
   - è®¾ç½®æ–°èŠ‚ç‚¹çš„ random æŒ‡é’ˆ
4. è¿”å›æ–°é“¾è¡¨çš„å¤´èŠ‚ç‚¹

#### ğŸ§© ç¤ºä¾‹åˆ†æ

ä»¥ç¤ºä¾‹ 1 ä¸ºä¾‹ï¼Œåˆ†æå¤åˆ¶è¿‡ç¨‹ï¼š

```
åŸé“¾è¡¨ï¼š
7 -> 13 -> 11 -> 10 -> 1
     â†“           â†“
     7    11 <- 13    1
```

1. ç¬¬ä¸€æ¬¡éå†ï¼Œåˆ›å»ºæ–°èŠ‚ç‚¹ï¼š
```
visited = {
    7 -> 7'
    13 -> 13'
    11 -> 11'
    10 -> 10'
    1 -> 1'
}
```

2. ç¬¬äºŒæ¬¡éå†ï¼Œè®¾ç½®æŒ‡é’ˆï¼š
```
7'.next = 13'
13'.next = 11'
11'.next = 10'
10'.next = 1'

13'.random = 7'
11'.random = 4'
10'.random = 11'
1'.random = 7'
```

### æ–¹æ³•äºŒï¼šèŠ‚ç‚¹äº¤é”™

è¿˜æœ‰ä¸€ç§ä¸ä½¿ç”¨é¢å¤–ç©ºé—´çš„è§£æ³•ï¼Œæ€è·¯æ˜¯ï¼š
1. åœ¨æ¯ä¸ªåŸèŠ‚ç‚¹åé¢åˆ›å»ºå…¶å¯¹åº”çš„æ–°èŠ‚ç‚¹
2. è®¾ç½®æ–°èŠ‚ç‚¹çš„ random æŒ‡é’ˆ
3. å°†ä¸¤ä¸ªé“¾è¡¨åˆ†ç¦»

è¿™ç§æ–¹æ³•è™½ç„¶ä¸éœ€è¦é¢å¤–ç©ºé—´ï¼Œä½†æ˜¯ä¼šä¿®æ”¹åŸé“¾è¡¨çš„ç»“æ„ï¼ˆè™½ç„¶æœ€åä¼šæ¢å¤ï¼‰ï¼Œè€Œä¸”ä»£ç è¾ƒä¸ºå¤æ‚ã€‚è€ƒè™‘åˆ°ç°ä»£è®¡ç®—æœºå†…å­˜å……è¶³ï¼Œä½¿ç”¨å“ˆå¸Œè¡¨çš„æ–¹æ³•æ›´åŠ æ¸…æ™°å’Œæ˜“äºç»´æŠ¤ã€‚

---

## ä»£ç å®ç°

å®Œæ•´çš„å¯è¿è¡Œä»£ç ï¼š[L0138_CopyListWithRandomPointer.java](../src/main/java/L0138_CopyListWithRandomPointer.java)

```java
public Node copyRandomList(Node head) {
    if (head == null) {
        return null;
    }
    
    // ä½¿ç”¨å“ˆå¸Œè¡¨å­˜å‚¨åŸèŠ‚ç‚¹åˆ°æ–°èŠ‚ç‚¹çš„æ˜ å°„
    Map<Node, Node> visited = new HashMap<>();
    
    // ç¬¬ä¸€æ¬¡éå†ï¼šåˆ›å»ºæ‰€æœ‰æ–°èŠ‚ç‚¹
    Node curr = head;
    while (curr != null) {
        visited.put(curr, new Node(curr.val));
        curr = curr.next;
    }
    
    // ç¬¬äºŒæ¬¡éå†ï¼šè®¾ç½®æ–°èŠ‚ç‚¹çš„ next å’Œ random æŒ‡é’ˆ
    curr = head;
    while (curr != null) {
        visited.get(curr).next = visited.get(curr.next);
        visited.get(curr).random = visited.get(curr.random);
        curr = curr.next;
    }
    
    return visited.get(head);
}
```

---

## å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼šO(n)
  - éœ€è¦ä¸¤æ¬¡éå†é“¾è¡¨
  - æ¯æ¬¡éå†éƒ½æ˜¯ O(n)
  - å“ˆå¸Œè¡¨çš„æŸ¥æ‰¾æ“ä½œæ˜¯ O(1)

- **ç©ºé—´å¤æ‚åº¦**ï¼šO(n)
  - éœ€è¦å“ˆå¸Œè¡¨å­˜å‚¨ n ä¸ªèŠ‚ç‚¹çš„æ˜ å°„å…³ç³»
  - è¿”å›çš„æ–°é“¾è¡¨ä¸è®¡å…¥é¢å¤–ç©ºé—´

## ç›¸å…³é¢˜ç›®

- [133. å…‹éš†å›¾](https://leetcode.cn/problems/clone-graph/)
- [1485. å…‹éš†å«éšæœºæŒ‡é’ˆçš„äºŒå‰æ ‘](https://leetcode.cn/problems/clone-binary-tree-with-random-pointer/)

## LeetCode é¢˜è§£

æœ¬é¢˜è§£æ˜¯ LeetCode ç³»åˆ—é¢˜è§£çš„ä¸€éƒ¨åˆ†ã€‚è¯¥ç³»åˆ—é¢˜è§£è‡´åŠ›äºå¸®åŠ©ç¨‹åºå‘˜æ›´å¥½åœ°ç†è§£å’ŒæŒæ¡ç®—æ³•æ€ç»´ï¼Œå†…å®¹åŒ…å«è¯¦ç»†çš„è§£é¢˜æ€è·¯åˆ†æã€å›¾æ–‡å¹¶èŒ‚çš„ç¤ºä¾‹è®²è§£å’Œå®Œæ•´çš„ä»£ç å®ç°ã€‚

[LeetCode æœ€å…¨é¢˜è§£](https://github.com/LjyYano/LeetCode)ï¼šæŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿ Star â­ï¸ å…³æ³¨ï¼Œä¸€èµ·æ¢è®¨ç®—æ³•ä¹‹ç¾ã€‚ 
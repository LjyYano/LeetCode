---
title: 部门工资中位数
date: 2024-02-09
---

## 题目描述

**🔗 题目**：[部门工资中位数](https://leetcode.cn/problems/department-median-salary/)  
**🏷️ 标签**：`数据库`  
**🟡 难度**：`困难`  

表: Employee
```
+--------------+---------+
| Column Name  | Type    |
+--------------+---------+
| id           | int     |
| company      | varchar |
| salary       | int     |
+--------------+---------+
```
id 是该表的主键列。
company 是公司的名字。
salary 是员工的工资。

写一个 SQL 查询，查找每个公司的工资中位数。

返回结果表 不分顺序 。

示例 1:
输入: 
Employee 表:
```
+----+---------+--------+
| id | company | salary |
+----+---------+--------+
| 1  | A       | 2341   |
| 2  | A       | 341    |
| 3  | A       | 15     |
| 4  | A       | 15314  |
| 5  | A       | 451    |
| 6  | A       | 513    |
| 7  | B       | 15     |
| 8  | B       | 13     |
| 9  | B       | 1154   |
| 10 | B       | 1345   |
| 11 | B       | 1221   |
| 12 | B       | 234    |
| 13 | C       | 2345   |
| 14 | C       | 2645   |
| 15 | C       | 2645   |
| 16 | C       | 2652   |
| 17 | C       | 65     |
+----+---------+--------+
```
输出: 
```
+---------+--------+
| company | median |
+---------+--------+
| A       | 482    |
| B       | 677    |
| C       | 2645   |
+---------+--------+
```
解释：
A 公司的工资从小到大为 [15, 341, 451, 513, 2341, 15314]。中位数为 (451 + 513) / 2 = 482。
B 公司的工资从小到大为 [13, 15, 234, 1154, 1221, 1345]，中位数为 (234 + 1154) / 2 = 677。
C 公司的工资从小到大为 [65, 2345, 2645, 2645, 2652]，中位数为 2645。

---

## 解题思路

### SQL 窗口函数实现

#### 📝 核心思想
要计算每个公司的工资中位数，我们需要：
1. 使用窗口函数对每个公司的工资进行排序
2. 计算每个公司的员工总数
3. 根据总数的奇偶性来确定中位数的计算方式
4. 使用 ROUND 函数处理结果

#### 🛠️ 实现步骤
1. 使用 CTE（公共表表达式）创建一个包含排名的临时表：
   - ROW_NUMBER() 为每个公司的工资排序
   - COUNT(*) 计算每个公司的员工总数
2. 在主查询中：
   - 使用 IN 子句选择中位数位置的记录
   - 使用 AVG 函数计算中位数
   - 使用 ROUND 函数处理结果

#### 🧩 示例分析
以公司 A 为例，分析计算过程：

1. 排序后的数据：
```
+----+---------+--------+----+-----+
| id | company | salary | rk | cnt |
+----+---------+--------+----+-----+
| 3  | A       | 15     | 1  | 6   |
| 2  | A       | 341    | 2  | 6   |
| 5  | A       | 451    | 3  | 6   |
| 6  | A       | 513    | 4  | 6   |
| 1  | A       | 2341   | 5  | 6   |
| 4  | A       | 15314  | 6  | 6   |
+----+---------+--------+----+-----+
```

2. 中位数计算：

| 公司 | 员工数 | 排名条件 | 选中的工资 | 中位数计算 |
|-----|--------|----------|------------|------------|
| A   | 6      | rk in (3,4) | 451, 513   | (451+513)/2 = 482 |
| B   | 6      | rk in (3,4) | 234, 1154  | (234+1154)/2 = 677 |
| C   | 5      | rk in (3,3) | 2645       | 2645 |

3. 最终结果：
```
+---------+--------+
| company | median |
+---------+--------+
| A       | 482    |
| B       | 677    |
| C       | 2645   |
+---------+--------+
```

---

## 代码实现

完整的可运行代码：[L0198_DepartmentMedianSalary.sql](../src/main/sql/L0198_DepartmentMedianSalary.sql)

```sql
WITH RankedSalaries AS (
    SELECT 
        id,
        company,
        salary,
        ROW_NUMBER() OVER (PARTITION BY company ORDER BY salary ASC) as rk,
        COUNT(*) OVER (PARTITION BY company) as cnt
    FROM Employee
)
SELECT 
    company,
    ROUND(
        AVG(salary),
        0
    ) as median
FROM RankedSalaries
WHERE 
    rk IN ((cnt + 1)/2, (cnt + 2)/2)
```

---

## 复杂度分析

- **时间复杂度**：O(n log n)，其中 n 是表中的记录数。这是由于需要对每个公司的工资进行排序。
- **空间复杂度**：O(n)，需要存储排序后的结果。

---

## LeetCode 题解

本题解是 LeetCode 系列题解的一部分。该系列题解致力于帮助程序员更好地理解和掌握算法思维，内容包含详细的解题思路分析、图文并茂的示例讲解和完整的代码实现。

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode 最全题解](https://github.com/LjyYano/LeetCode)：持续更新中，欢迎 Star ⭐️ 关注，一起探讨算法之美。 
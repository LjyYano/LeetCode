---
title: 最长有效括号
date: 2025-02-08
---

## 题目描述

**🔗 题目**：[最长有效括号](https://leetcode.cn/problems/longest-valid-parentheses/)  
**🏷️ 标签**：`栈` `字符串` `动态规划`  
**🔴 难度**：`困难`  

给你一个只包含 '(' 和 ')' 的字符串，找出最长有效（格式正确且连续）括号子串的长度。

**示例 1：**
```
输入：s = "(()"
输出：2
解释：最长有效括号子串是 "()"
```

**示例 2：**
```
输入：s = ")()())"
输出：4
解释：最长有效括号子串是 "()()"
```

**示例 3：**
```
输入：s = ""
输出：0
```

**提示：**
- 0 <= s.length <= 3 * 10⁴
- s[i] 为 '(' 或 ')'

---

## 解题思路

### 栈解法

#### 📝 核心思想
使用栈来处理括号匹配问题是一种常见的思路。在本题中，我们不仅需要判断括号是否匹配，还需要计算最长的有效括号子串长度。关键是使用栈来存储括号的下标，而不是括号本身。

#### 🛠️ 实现步骤
1. 初始化一个栈，并放入 -1 作为哨兵（便于计算长度）
2. 遍历字符串：
   - 遇到左括号 '('：将其下标入栈
   - 遇到右括号 ')'：
     - 弹出栈顶元素
     - 如果栈为空：将当前右括号的下标入栈（作为新的参考点）
     - 如果栈不为空：计算当前有效括号串的长度（当前下标减去栈顶元素）
3. 维护最大长度

#### 🧩 示例分析
以字符串 ")()())" 为例，让我们看看算法是如何工作的：

| 步骤 | 字符 | 栈的内容 | 最大长度 | 说明 |
|-----|------|---------|---------|------|
| 初始 | - | [-1] | 0 | 初始化栈，放入哨兵 -1 |
| 1 | ) | [0] | 0 | 栈空，将右括号下标 0 入栈 |
| 2 | ( | [0,1] | 0 | 左括号下标 1 入栈 |
| 3 | ) | [0] | 2 | 匹配成功，计算长度：2-0=2 |
| 4 | ( | [0,3] | 2 | 左括号下标 3 入栈 |
| 5 | ) | [0] | 4 | 匹配成功，计算长度：4-0=4 |
| 6 | ) | [5] | 4 | 栈空，将右括号下标 5 入栈 |

通过上面的分析，我们可以看到：
1. 哨兵 -1 的作用是为了处理字符串开头就能匹配的情况
2. 栈为空时入栈的右括号下标，会作为后续计算长度的新参考点
3. 最终得到最长有效括号长度为 4，对应子串 "()()"

---

## 代码实现

完整的可运行代码：[L0032_LongestValidParentheses.java](../src/main/java/L0032_LongestValidParentheses.java)

```java
public class L0032_LongestValidParentheses {

    public static int longestValidParentheses(String s) {
        // 使用栈来解决，栈中存储的是下标
        Stack<Integer> stack = new Stack<>();
        // 初始化栈，放入 -1 作为哨兵，便于计算长度
        stack.push(-1);
        int maxLength = 0;

        for (int i = 0; i < s.length(); i++) {
            if (s.charAt(i) == '(') {
                // 遇到左括号，将其下标入栈
                stack.push(i);
            } else {
                // 遇到右括号，先弹出栈顶元素
                stack.pop();
                if (stack.isEmpty()) {
                    // 如果栈为空，说明当前右括号不能匹配，将其下标入栈
                    stack.push(i);
                } else {
                    // 如果栈不为空，说明找到了一个有效的括号对
                    // 计算当前有效括号串的长度
                    maxLength = Math.max(maxLength, i - stack.peek());
                }
            }
        }
        return maxLength;
    }
}
```

---

## 复杂度分析

- **时间复杂度**：O(n)，其中 n 是字符串的长度。我们只需要遍历字符串一次。
- **空间复杂度**：O(n)，栈的大小最多为 n。

---

## LeetCode 题解

本题解是 LeetCode 系列题解的一部分。该系列题解致力于帮助程序员更好地理解和掌握算法思维，内容包含详细的解题思路分析、图文并茂的示例讲解和完整的代码实现。

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode 最全题解](https://github.com/LjyYano/LeetCode)：持续更新中，欢迎 Star ⭐️ 关注，一起探讨算法之美。 
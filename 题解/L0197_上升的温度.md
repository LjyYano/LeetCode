---
title: 上升的温度
date: 2024-02-09
---

## 题目描述

**🔗 题目**：[上升的温度](https://leetcode.cn/problems/rising-temperature/)  
**🏷️ 标签**：`数据库`  
**🟡 难度**：`简单`  

表: Weather
```
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| id            | int     |
| recordDate    | date    |
| temperature   | int     |
+---------------+---------+
```
id 是该表的主键（具有唯一值的列）。
该表包含特定日期的温度信息。

编写一个 SQL 查询，查找与之前（昨天的）日期相比温度更高的所有日期的 id 。

返回结果 不要求顺序 。

示例 1:
输入: 
Weather 表：
```
+----+------------+-------------+
| id | recordDate | temperature |
+----+------------+-------------+
| 1  | 2015-01-01 | 10         |
| 2  | 2015-01-02 | 25         |
| 3  | 2015-01-03 | 20         |
| 4  | 2015-01-04 | 30         |
+----+------------+-------------+
```
输出: 
```
+----+
| id |
+----+
| 2  |
| 4  |
+----+
```
解释：
2015-01-02 的温度比前一天高（10 → 25）
2015-01-04 的温度比前一天高（20 → 30）

---

## 解题思路

### SQL 自连接实现

#### 📝 核心思想
要找出温度比前一天高的日期，我们需要：
1. 使用自连接比较每天的温度和前一天的温度
2. 使用 DATEDIFF 函数来确保比较的是相邻的两天
3. 找出温度更高的日期的 id

#### 🛠️ 实现步骤
1. 使用自连接将 Weather 表与自身连接
2. 在 WHERE 子句中设置条件：
   - 当天温度高于前一天：w1.Temperature > w2.Temperature
   - 日期相差一天：DATEDIFF(w1.recordDate, w2.recordDate) = 1
3. 选择满足条件的 id

#### 🧩 示例分析
以示例数据为例，分析查询过程：

1. 原始数据：
```
+----+------------+-------------+
| id | recordDate | temperature |
+----+------------+-------------+
| 1  | 2015-01-01 | 10         |
| 2  | 2015-01-02 | 25         |
| 3  | 2015-01-03 | 20         |
| 4  | 2015-01-04 | 30         |
+----+------------+-------------+
```

2. 自连接后的比较：

| w1.id | w1.date     | w1.temp | w2.id | w2.date     | w2.temp | 是否上升 |
|-------|-------------|---------|-------|-------------|---------|----------|
| 2     | 2015-01-02  | 25      | 1     | 2015-01-01  | 10      | 是       |
| 3     | 2015-01-03  | 20      | 2     | 2015-01-02  | 25      | 否       |
| 4     | 2015-01-04  | 30      | 3     | 2015-01-03  | 20      | 是       |

3. 最终结果：
```
+----+
| id |
+----+
| 2  |
| 4  |
+----+
```

---

## 代码实现

完整的可运行代码：[L0197_RisingTemperature.sql](../src/main/sql/L0197_RisingTemperature.sql)

```sql
SELECT w1.id
FROM Weather w1, Weather w2
WHERE w1.Temperature > w2.Temperature
    AND DATEDIFF(w1.recordDate, w2.recordDate) = 1
```

---

## 复杂度分析

- **时间复杂度**：O(n²)，其中 n 是表中的记录数。这是由于需要进行自连接操作。
- **空间复杂度**：O(1)，只需要常量空间来存储临时变量。

---

## LeetCode 题解

本题解是 LeetCode 系列题解的一部分。该系列题解致力于帮助程序员更好地理解和掌握算法思维，内容包含详细的解题思路分析、图文并茂的示例讲解和完整的代码实现。

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode 最全题解](https://github.com/LjyYano/LeetCode)：持续更新中，欢迎 Star ⭐️ 关注，一起探讨算法之美。 
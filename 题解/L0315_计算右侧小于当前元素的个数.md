---
title: è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°
date: 2025-02-10
---

## é¢˜ç›®æè¿°

**ğŸ”— é¢˜ç›®**ï¼š[è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°](https://leetcode.cn/problems/count-of-smaller-numbers-after-self/)  
**ğŸ·ï¸ æ ‡ç­¾**ï¼š`æ ‘çŠ¶æ•°ç»„` `çº¿æ®µæ ‘` `æ•°ç»„` `äºŒåˆ†æŸ¥æ‰¾` `åˆ†æ²»` `æœ‰åºé›†åˆ` `å½’å¹¶æ’åº`  
**ğŸ”´ éš¾åº¦**ï¼š`å›°éš¾`  

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼ŒæŒ‰è¦æ±‚è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ counts ã€‚æ•°ç»„ counts æœ‰è¯¥æ€§è´¨ï¼š counts[i] çš„å€¼æ˜¯  nums[i] å³ä¾§å°äº nums[i] çš„å…ƒç´ çš„æ•°é‡ã€‚

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼šnums = [5,2,6,1]
è¾“å‡ºï¼š[2,1,1,0]
è§£é‡Šï¼š
5 çš„å³ä¾§æœ‰ 2 ä¸ªæ›´å°çš„å…ƒç´  (2 å’Œ 1)
2 çš„å³ä¾§æœ‰ 1 ä¸ªæ›´å°çš„å…ƒç´  (1)
6 çš„å³ä¾§æœ‰ 1 ä¸ªæ›´å°çš„å…ƒç´  (1)
1 çš„å³ä¾§æœ‰ 0 ä¸ªæ›´å°çš„å…ƒç´ 
```

ç¤ºä¾‹ 2ï¼š
```
è¾“å…¥ï¼šnums = [-1]
è¾“å‡ºï¼š[0]
```

ç¤ºä¾‹ 3ï¼š
```
è¾“å…¥ï¼šnums = [-1,-1]
è¾“å‡ºï¼š[0,0]
```

æç¤ºï¼š
- 1 <= nums.length <= 10âµ
- -10â´ <= nums[i] <= 10â´

---

## è§£é¢˜æ€è·¯
### æ ‘çŠ¶æ•°ç»„

#### ğŸ“ æ ¸å¿ƒæ€æƒ³
è¿™é“é¢˜å¯ä»¥ä½¿ç”¨æ ‘çŠ¶æ•°ç»„ï¼ˆBinary Indexed Treeï¼Œä¹Ÿç§° Fenwick Treeï¼‰æ¥è§£å†³ã€‚æ ‘çŠ¶æ•°ç»„æ˜¯ä¸€ç§æ”¯æŒå•ç‚¹ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢çš„æ•°æ®ç»“æ„ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†å‰ç¼€å’Œç›¸å…³çš„é—®é¢˜ã€‚

å…³é”®æ€è·¯ï¼š
1. é¦–å…ˆå¯¹æ•°ç»„è¿›è¡Œç¦»æ•£åŒ–ï¼Œå°†æ‰€æœ‰æ•°å­—æ˜ å°„åˆ°å®ƒä»¬çš„æ’åä¸Š
2. ä»å³å‘å·¦éå†æ•°ç»„ï¼Œå¯¹äºæ¯ä¸ªæ•°å­—ï¼š
   - æŸ¥è¯¢æ¯”å½“å‰æ•°å­—å°çš„æ•°çš„ä¸ªæ•°ï¼ˆé€šè¿‡æŸ¥è¯¢æ ‘çŠ¶æ•°ç»„å‰ç¼€å’Œå®ç°ï¼‰
   - å°†å½“å‰æ•°å­—çš„å‡ºç°æ¬¡æ•°åŠ å…¥æ ‘çŠ¶æ•°ç»„

#### ğŸ› ï¸ å®ç°æ­¥éª¤
1. ç¦»æ•£åŒ–å¤„ç†ï¼š
   - ä½¿ç”¨ TreeSet å»é‡å¹¶æ’åº
   - å»ºç«‹æ•°å­—åˆ°æ’åçš„æ˜ å°„å…³ç³»

2. åˆå§‹åŒ–æ ‘çŠ¶æ•°ç»„ï¼š
   - å¤§å°ä¸ºç¦»æ•£åŒ–åçš„ä¸åŒæ•°å­—ä¸ªæ•°åŠ  1
   - æ‰€æœ‰å…ƒç´ åˆå§‹åŒ–ä¸º 0

3. ä»å³å‘å·¦éå†åŸæ•°ç»„ï¼š
   - è·å–å½“å‰æ•°å­—çš„æ’å
   - æŸ¥è¯¢æ ‘çŠ¶æ•°ç»„ä¸­æ¯”å½“å‰æ’åå°çš„æ•°çš„ä¸ªæ•°
   - æ›´æ–°æ ‘çŠ¶æ•°ç»„ï¼Œå°†å½“å‰æ’åä½ç½®çš„è®¡æ•°åŠ  1

4. è¿”å›ç»“æœæ•°ç»„

#### ğŸ§© ç¤ºä¾‹åˆ†æ
ä»¥ç¤ºä¾‹ 1ï¼šnums = [5,2,6,1] ä¸ºä¾‹ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ç®—æ³•æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š

1. ç¦»æ•£åŒ–è¿‡ç¨‹ï¼š
```
åŸæ•°ç»„ï¼š[5,2,6,1]
æ’åºå»é‡ï¼š[1,2,5,6]
æ˜ å°„å…³ç³»ï¼š1->1, 2->2, 5->3, 6->4
```

2. ä»å³å‘å·¦éå†çš„è¿‡ç¨‹ï¼š

| æ­¥éª¤ | å½“å‰æ•°å­— | æ’å | æ ‘çŠ¶æ•°ç»„çŠ¶æ€ | æŸ¥è¯¢ç»“æœ | è¯´æ˜ |
|-----|---------|-----|-------------|---------|-----|
| 1 | 1 | 1 | [0,0,0,0,0] | 0 | æœ€å³è¾¹çš„æ•°å­—ï¼Œå³ä¾§æ²¡æœ‰æ›´å°çš„æ•° |
| 2 | 6 | 4 | [0,1,1,1,1] | 1 | å³ä¾§æœ‰ 1 ä¸ªæ›´å°çš„æ•° (1) |
| 3 | 2 | 2 | [0,1,1,1,2] | 1 | å³ä¾§æœ‰ 1 ä¸ªæ›´å°çš„æ•° (1) |
| 4 | 5 | 3 | [0,1,2,2,3] | 2 | å³ä¾§æœ‰ 2 ä¸ªæ›´å°çš„æ•° (2,1) |

è®©æˆ‘ä»¬è¯¦ç»†åˆ†æç¬¬ 4 æ­¥ï¼ˆå¤„ç†æ•°å­— 5ï¼‰çš„è¿‡ç¨‹ï¼š

1. è·å– 5 çš„æ’åï¼š3
2. æŸ¥è¯¢æ ‘çŠ¶æ•°ç»„å‰ç¼€å’Œï¼š
   ```
   query(2) = tree[2] + tree[1] = 2
   è¡¨ç¤ºæ’åå°äº 3 çš„æ•°å­—å‡ºç°äº† 2 æ¬¡
   ```
3. æ›´æ–°æ ‘çŠ¶æ•°ç»„ï¼š
   ```
   update(3, 1)ï¼š
   tree[3] += 1
   tree[4] += 1
   ```

æ ‘çŠ¶æ•°ç»„çš„å·¥ä½œåŸç†ï¼š
1. lowbit è¿ç®—ï¼š
   ```
   lowbit(x) = x & (-x)
   ä¾‹å¦‚ï¼šlowbit(6) = 6 & (-6) = 6 & (1...10) = 2
   ```

2. æ›´æ–°æ“ä½œï¼ˆå‡è®¾æ›´æ–°ä½ç½® 3ï¼‰ï¼š
   ```
   3 -> 4 -> 8 -> ...
   å³ï¼šæ¯æ¬¡åŠ ä¸Š lowbit å¾—åˆ°çˆ¶èŠ‚ç‚¹
   ```

3. æŸ¥è¯¢æ“ä½œï¼ˆå‡è®¾æŸ¥è¯¢ä½ç½® 7ï¼‰ï¼š
   ```
   7 -> 6 -> 4 -> 0
   å³ï¼šæ¯æ¬¡å‡å» lowbit å¾—åˆ°å‰ä¸€ä¸ªè¦†ç›–åŒºé—´
   ```

---

## ä»£ç å®ç°

å®Œæ•´çš„å¯è¿è¡Œä»£ç ï¼š[L0315_CountOfSmallerNumbersAfterSelf.java](../src/main/java/L0315_CountOfSmallerNumbersAfterSelf.java)

```java
public class L0315_CountOfSmallerNumbersAfterSelf {
    
    // æ ‘çŠ¶æ•°ç»„
    private int[] tree;
    // æ•°ç»„å¤§å°
    private int n;
    
    // è·å– lowbit
    private int lowbit(int x) {
        return x & (-x);
    }
    
    // æ›´æ–°æ ‘çŠ¶æ•°ç»„
    private void update(int x, int val) {
        while (x <= n) {
            tree[x] += val;
            x += lowbit(x);
        }
    }
    
    // æŸ¥è¯¢å‰ç¼€å’Œ
    private int query(int x) {
        int sum = 0;
        while (x > 0) {
            sum += tree[x];
            x -= lowbit(x);
        }
        return sum;
    }
    
    public List<Integer> countSmaller(int[] nums) {
        // ç¦»æ•£åŒ–
        Set<Integer> set = new TreeSet<>();
        for (int num : nums) {
            set.add(num);
        }
        // å»ºç«‹æ•°å­—åˆ°æ’åçš„æ˜ å°„
        Map<Integer, Integer> map = new HashMap<>();
        int rank = 1;
        for (int num : set) {
            map.put(num, rank++);
        }
        
        n = map.size();
        tree = new int[n + 1];
        Integer[] result = new Integer[nums.length];
        
        // ä»å³å‘å·¦éå†
        for (int i = nums.length - 1; i >= 0; i--) {
            // è·å–å½“å‰æ•°å­—çš„æ’å
            int id = map.get(nums[i]);
            // æŸ¥è¯¢æ¯”å½“å‰æ•°å­—å°çš„æ•°çš„ä¸ªæ•°
            result[i] = query(id - 1);
            // æ›´æ–°æ ‘çŠ¶æ•°ç»„
            update(id, 1);
        }
        
        return Arrays.asList(result);
    }
}
```

---

## å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼šO(n log n)
  - ç¦»æ•£åŒ–è¿‡ç¨‹éœ€è¦ O(n log n) çš„æ—¶é—´
  - æ ‘çŠ¶æ•°ç»„çš„å•æ¬¡æ›´æ–°å’ŒæŸ¥è¯¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(log n)
  - éœ€è¦å¯¹æ•°ç»„è¿›è¡Œä¸€æ¬¡éå†ï¼Œæ¯ä¸ªå…ƒç´ éƒ½è¦è¿›è¡Œä¸€æ¬¡æ›´æ–°å’ŒæŸ¥è¯¢ï¼Œæ€»æ—¶é—´å¤æ‚åº¦ä¸º O(n log n)

- **ç©ºé—´å¤æ‚åº¦**ï¼šO(n)
  - éœ€è¦é¢å¤–çš„ç©ºé—´æ¥å­˜å‚¨æ ‘çŠ¶æ•°ç»„
  - éœ€è¦ç©ºé—´å­˜å‚¨ç¦»æ•£åŒ–åçš„æ˜ å°„å…³ç³»
  - éœ€è¦ç©ºé—´å­˜å‚¨ç»“æœæ•°ç»„

---

## LeetCode é¢˜è§£

æœ¬é¢˜è§£æ˜¯ LeetCode ç³»åˆ—é¢˜è§£çš„ä¸€éƒ¨åˆ†ã€‚è¯¥ç³»åˆ—é¢˜è§£è‡´åŠ›äºå¸®åŠ©ç¨‹åºå‘˜æ›´å¥½åœ°ç†è§£å’ŒæŒæ¡ç®—æ³•æ€ç»´ï¼Œå†…å®¹åŒ…å«è¯¦ç»†çš„è§£é¢˜æ€è·¯åˆ†æã€å›¾æ–‡å¹¶èŒ‚çš„ç¤ºä¾‹è®²è§£å’Œå®Œæ•´çš„ä»£ç å®ç°ã€‚

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode æœ€å…¨é¢˜è§£](https://github.com/LjyYano/LeetCode)ï¼šæŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿ Star â­ï¸ å…³æ³¨ï¼Œä¸€èµ·æ¢è®¨ç®—æ³•ä¹‹ç¾ã€‚ 
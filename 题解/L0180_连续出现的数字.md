---
title: 连续出现的数字
date: 2024-02-10
---

## 题目描述

**🔗 题目**：[连续出现的数字](https://leetcode.cn/problems/consecutive-numbers/)  
**🏷️ 标签**：`数据库`  
**🟡 难度**：`中等`  

表：Logs
```
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| id          | int     |
| num         | varchar |
+-------------+---------+
```
id 是这个表的主键。  
id 是一个自增的列。  

编写一个 SQL 查询，查找所有至少连续出现三次的数字。

返回的结果表中的数据可以按 任意顺序 排列。

示例 1：  
输入：  
Logs 表：
```
+----+-----+
| id | num |
+----+-----+
| 1  | 1   |
| 2  | 1   |
| 3  | 1   |
| 4  | 2   |
| 5  | 1   |
| 6  | 2   |
| 7  | 2   |
+----+-----+
```
输出：
```
+-----------------+
| ConsecutiveNums |
+-----------------+
| 1               |
+-----------------+
```
解释：1 是唯一连续出现至少三次的数字。

---

## 解题思路

### 自连接查询

#### 📝 核心思想
要找出连续出现三次的数字，我们需要：
1. 使用自连接将同一个表连接三次，分别代表连续的三条记录
2. 通过 id 的连续性（id + 1）来确保记录是连续的
3. 通过比较 num 值来确保这些连续记录的数字相同
4. 使用 DISTINCT 去除重复的结果

#### 🛠️ 实现步骤
1. 将 Logs 表自连接三次，分别命名为 l1、l2、l3
2. 使用 WHERE 子句确保：
   - l1.id = l2.id - 1 AND l2.id = l3.id - 1（确保记录连续）
   - l1.num = l2.num AND l2.num = l3.num（确保数字相同）
3. 使用 DISTINCT 去除重复值
4. 选择 num 作为结果

#### 🧩 示例分析
以示例数据为例，让我们看看查询是如何工作的：

1. 原始数据：
   ```
   +----+-----+
   | id | num |
   +----+-----+
   | 1  | 1   |
   | 2  | 1   |
   | 3  | 1   |
   | 4  | 2   |
   | 5  | 1   |
   | 6  | 2   |
   | 7  | 2   |
   +----+-----+
   ```

2. 自连接后的匹配情况：
   | l1.id | l1.num | l2.id | l2.num | l3.id | l3.num | 是否满足条件 |
   |-------|---------|-------|---------|-------|---------|--------------|
   | 1     | 1       | 2     | 1       | 3     | 1       | 是           |
   | 4     | 2       | 5     | 1       | 6     | 2       | 否           |
   | 5     | 1       | 6     | 2       | 7     | 2       | 否           |

3. 最终结果：
   ```
   +-----------------+
   | ConsecutiveNums |
   +-----------------+
   | 1               |
   +-----------------+
   ```

---

## 代码实现

完整的可运行代码：[L0180_ConsecutiveNumbers.sql](../src/main/sql/L0180_ConsecutiveNumbers.sql)

```sql
SELECT DISTINCT l1.num AS ConsecutiveNums
FROM Logs l1, Logs l2, Logs l3
WHERE l1.id = l2.id - 1
AND l2.id = l3.id - 1
AND l1.num = l2.num
AND l2.num = l3.num
```

---

## 复杂度分析

- **时间复杂度**：O(n³)，其中 n 是表中的记录数
  - 需要进行三次自连接，每次连接都需要遍历整个表
  - 使用索引可以优化查找性能
  - 如果数据量很大，可以考虑使用窗口函数等其他优化方案

- **空间复杂度**：O(n)
  - 需要存储连接操作的中间结果
  - n 是表中的记录数

---

## LeetCode 题解

本题解是 LeetCode 系列题解的一部分。该系列题解致力于帮助程序员更好地理解和掌握算法思维，内容包含详细的解题思路分析、图文并茂的示例讲解和完整的代码实现。

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode 最全题解](https://github.com/LjyYano/LeetCode)：持续更新中，欢迎 Star ⭐️ 关注，一起探讨算法之美。 
---
title: å…¨ O(1) çš„æ•°æ®ç»“æ„
date: 2024-03-27
---

## é¢˜ç›®æè¿°

**ğŸ”— é¢˜ç›®**ï¼š[å…¨ O(1) çš„æ•°æ®ç»“æ„](https://leetcode.cn/problems/all-oone-data-structure/)  
**ğŸ·ï¸ æ ‡ç­¾**ï¼š`è®¾è®¡` `å“ˆå¸Œè¡¨` `é“¾è¡¨` `åŒå‘é“¾è¡¨`  
**ğŸ”´ éš¾åº¦**ï¼š`å›°éš¾`  

è¯·ä½ è®¾è®¡ä¸€ä¸ªç”¨äºå­˜å‚¨å­—ç¬¦ä¸²è®¡æ•°çš„æ•°æ®ç»“æ„ï¼Œå¹¶èƒ½å¤Ÿè¿”å›è®¡æ•°æœ€å°å’Œæœ€å¤§çš„å­—ç¬¦ä¸²ã€‚

å®ç° AllOne ç±»ï¼š
- AllOne() åˆå§‹åŒ–æ•°æ®ç»“æ„çš„å¯¹è±¡ã€‚
- inc(String key) å­—ç¬¦ä¸² key çš„è®¡æ•°å¢åŠ  1 ã€‚å¦‚æœæ•°æ®ç»“æ„ä¸­å°šä¸å­˜åœ¨ key ï¼Œé‚£ä¹ˆæ’å…¥è®¡æ•°ä¸º 1 çš„ key ã€‚
- dec(String key) å­—ç¬¦ä¸² key çš„è®¡æ•°å‡å°‘ 1 ã€‚å¦‚æœ key çš„è®¡æ•°åœ¨å‡å°‘åä¸º 0 ï¼Œé‚£ä¹ˆéœ€è¦å°†è¿™ä¸ª key ä»æ•°æ®ç»“æ„ä¸­åˆ é™¤ã€‚æµ‹è¯•ç”¨ä¾‹ä¿è¯ï¼šåœ¨å‡å°‘è®¡æ•°å‰ï¼Œkey å­˜åœ¨äºæ•°æ®ç»“æ„ä¸­ã€‚
- getMaxKey() è¿”å›ä»»æ„ä¸€ä¸ªè®¡æ•°æœ€å¤§çš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ²¡æœ‰å…ƒç´ å­˜åœ¨ï¼Œè¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸² "" ã€‚
- getMinKey() è¿”å›ä»»æ„ä¸€ä¸ªè®¡æ•°æœ€å°çš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ²¡æœ‰å…ƒç´ å­˜åœ¨ï¼Œè¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸² "" ã€‚

æ³¨æ„ï¼šæ¯ä¸ªå‡½æ•°éƒ½åº”å½“æ»¡è¶³ O(1) çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ã€‚

ç¤ºä¾‹ï¼š
```
è¾“å…¥
["AllOne", "inc", "inc", "getMaxKey", "getMinKey", "inc", "getMaxKey", "getMinKey"]
[[], ["hello"], ["hello"], [], [], ["leet"], [], []]
è¾“å‡º
[null, null, null, "hello", "hello", null, "hello", "leet"]

è§£é‡Š
AllOne allOne = new AllOne();
allOne.inc("hello");
allOne.inc("hello");
allOne.getMaxKey(); // è¿”å› "hello"
allOne.getMinKey(); // è¿”å› "hello"
allOne.inc("leet");
allOne.getMaxKey(); // è¿”å› "hello"
allOne.getMinKey(); // è¿”å› "leet"
```

---

## è§£é¢˜æ€è·¯

### åŒå‘é“¾è¡¨ + å“ˆå¸Œè¡¨

#### ğŸ“ æ ¸å¿ƒæ€æƒ³
è¦å®ç°æ‰€æœ‰æ“ä½œçš„ O(1) æ—¶é—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬éœ€è¦å·§å¦™åœ°ç»„åˆä¸¤ä¸ªæ•°æ®ç»“æ„ï¼š
1. åŒå‘é“¾è¡¨ï¼šæŒ‰ç…§è®¡æ•°å€¼ä»å°åˆ°å¤§æ’åºï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ç›¸åŒè®¡æ•°çš„æ‰€æœ‰å­—ç¬¦ä¸²
2. å“ˆå¸Œè¡¨ï¼šå­˜å‚¨æ¯ä¸ªå­—ç¬¦ä¸²åˆ°å…¶æ‰€åœ¨é“¾è¡¨èŠ‚ç‚¹çš„æ˜ å°„

è¿™æ ·è®¾è®¡çš„ä¼˜åŠ¿æ˜¯ï¼š
- é€šè¿‡å“ˆå¸Œè¡¨å¯ä»¥ O(1) æ—¶é—´æ‰¾åˆ°ä»»æ„å­—ç¬¦ä¸²æ‰€åœ¨çš„èŠ‚ç‚¹
- é€šè¿‡åŒå‘é“¾è¡¨å¯ä»¥ O(1) æ—¶é—´è·å–æœ€å¤§å€¼å’Œæœ€å°å€¼
- è®¡æ•°å¢å‡æ—¶ï¼Œåªéœ€è¦åœ¨é“¾è¡¨ä¸­ç§»åŠ¨èŠ‚ç‚¹ï¼Œä¹Ÿæ˜¯ O(1) æ—¶é—´

#### ğŸ› ï¸ å®ç°æ­¥éª¤

1. æ•°æ®ç»“æ„è®¾è®¡ï¼š
   - Node ç±»ï¼šåŒ…å«è®¡æ•°å€¼ã€å­—ç¬¦ä¸²é›†åˆã€å‰åæŒ‡é’ˆ
   - å“ˆå¸Œè¡¨ï¼šMap<String, Node>ï¼Œå­˜å‚¨å­—ç¬¦ä¸²åˆ°èŠ‚ç‚¹çš„æ˜ å°„
   - åŒå‘é“¾è¡¨ï¼šä½¿ç”¨å“¨å…µèŠ‚ç‚¹ï¼ˆhead å’Œ tailï¼‰ç®€åŒ–è¾¹ç•Œå¤„ç†

2. å¢åŠ è®¡æ•°ï¼ˆincï¼‰ï¼š
   - å¦‚æœå­—ç¬¦ä¸²ä¸å­˜åœ¨ï¼š
     * åˆ›å»ºè®¡æ•°ä¸º 1 çš„æ–°èŠ‚ç‚¹ï¼ˆå¦‚æœéœ€è¦ï¼‰
     * å°†å­—ç¬¦ä¸²æ·»åŠ åˆ°èŠ‚ç‚¹
   - å¦‚æœå­—ç¬¦ä¸²å­˜åœ¨ï¼š
     * å°†å­—ç¬¦ä¸²ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªè®¡æ•°èŠ‚ç‚¹
     * å¦‚æœéœ€è¦ï¼Œåˆ›å»ºæ–°çš„è®¡æ•°èŠ‚ç‚¹

3. å‡å°‘è®¡æ•°ï¼ˆdecï¼‰ï¼š
   - å¦‚æœå½“å‰è®¡æ•°ä¸º 1ï¼š
     * ç›´æ¥åˆ é™¤å­—ç¬¦ä¸²
     * å¦‚æœèŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ é™¤èŠ‚ç‚¹
   - å¦åˆ™ï¼š
     * å°†å­—ç¬¦ä¸²ç§»åŠ¨åˆ°å‰ä¸€ä¸ªè®¡æ•°èŠ‚ç‚¹
     * å¦‚æœéœ€è¦ï¼Œåˆ›å»ºæ–°çš„è®¡æ•°èŠ‚ç‚¹

4. è·å–æœ€å€¼ï¼š
   - getMaxKeyï¼šè¿”å› tail.prev èŠ‚ç‚¹ä¸­çš„ä»»æ„å­—ç¬¦ä¸²
   - getMinKeyï¼šè¿”å› head.next èŠ‚ç‚¹ä¸­çš„ä»»æ„å­—ç¬¦ä¸²

#### ğŸ§© ç¤ºä¾‹åˆ†æ

ä»¥ç¤ºä¾‹è¾“å…¥ä¸ºä¾‹ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ•°æ®ç»“æ„çš„å˜åŒ–è¿‡ç¨‹ï¼š

1. åˆå§‹çŠ¶æ€ï¼š
```
head <-> tail
keyNodeMap: {}
```

2. inc("hello")ï¼š
```
head <-> [1: {"hello"}] <-> tail
keyNodeMap: {"hello" -> Node(1)}
```

3. inc("hello")ï¼š
```
head <-> [1: {}] <-> [2: {"hello"}] <-> tail
keyNodeMap: {"hello" -> Node(2)}
```

4. inc("leet")ï¼š
```
head <-> [1: {"leet"}] <-> [2: {"hello"}] <-> tail
keyNodeMap: {
    "hello" -> Node(2),
    "leet" -> Node(1)
}
```

---

## ä»£ç å®ç°

å®Œæ•´çš„å¯è¿è¡Œä»£ç ï¼š[L0432_AllOne.java](../src/main/java/L0432_AllOne.java)

```java
public class L0432_AllOne {
    // åŒå‘é“¾è¡¨èŠ‚ç‚¹ç±»
    private class Node {
        int count;
        Set<String> keys;
        Node prev;
        Node next;
        
        Node(int count) {
            this.count = count;
            this.keys = new HashSet<>();
            this.prev = null;
            this.next = null;
        }
    }
    
    private Map<String, Node> keyNodeMap;
    private Node head;
    private Node tail;
    
    public L0432_AllOne() {
        keyNodeMap = new HashMap<>();
        head = new Node(0);    // æœ€å°å€¼èŠ‚ç‚¹
        tail = new Node(0);    // æœ€å¤§å€¼èŠ‚ç‚¹
        head.next = tail;
        tail.prev = head;
    }
    
    public void inc(String key) {
        // å¦‚æœ key ä¸å­˜åœ¨ï¼Œæ’å…¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
        if (!keyNodeMap.containsKey(key)) {
            if (head.next == tail || head.next.count > 1) {
                Node node = new Node(1);
                node.keys.add(key);
                insertAfter(head, node);
                keyNodeMap.put(key, node);
            } else {
                head.next.keys.add(key);
                keyNodeMap.put(key, head.next);
            }
            return;
        }
        
        // key å·²å­˜åœ¨ï¼Œå°†å…¶ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªè®¡æ•°çš„èŠ‚ç‚¹
        Node currNode = keyNodeMap.get(key);
        Node nextNode = currNode.next;
        
        if (nextNode == tail || nextNode.count > currNode.count + 1) {
            Node newNode = new Node(currNode.count + 1);
            newNode.keys.add(key);
            insertAfter(currNode, newNode);
            keyNodeMap.put(key, newNode);
        } else {
            nextNode.keys.add(key);
            keyNodeMap.put(key, nextNode);
        }
        
        currNode.keys.remove(key);
        if (currNode.keys.isEmpty()) {
            removeNode(currNode);
        }
    }
    
    public void dec(String key) {
        Node currNode = keyNodeMap.get(key);
        
        if (currNode.count == 1) {
            currNode.keys.remove(key);
            keyNodeMap.remove(key);
            if (currNode.keys.isEmpty()) {
                removeNode(currNode);
            }
            return;
        }
        
        Node prevNode = currNode.prev;
        if (prevNode == head || prevNode.count < currNode.count - 1) {
            Node newNode = new Node(currNode.count - 1);
            newNode.keys.add(key);
            insertAfter(prevNode, newNode);
            keyNodeMap.put(key, newNode);
        } else {
            prevNode.keys.add(key);
            keyNodeMap.put(key, prevNode);
        }
        
        currNode.keys.remove(key);
        if (currNode.keys.isEmpty()) {
            removeNode(currNode);
        }
    }
    
    public String getMaxKey() {
        if (tail.prev == head) {
            return "";
        }
        return tail.prev.keys.iterator().next();
    }
    
    public String getMinKey() {
        if (head.next == tail) {
            return "";
        }
        return head.next.keys.iterator().next();
    }
}
```

---

## å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼šæ‰€æœ‰æ“ä½œå‡ä¸º O(1)
  - incï¼š
    * å“ˆå¸Œè¡¨æŸ¥æ‰¾ï¼šO(1)
    * é“¾è¡¨èŠ‚ç‚¹æ’å…¥/åˆ é™¤ï¼šO(1)
    * HashSet æ“ä½œï¼šO(1)
  - decï¼š
    * å“ˆå¸Œè¡¨æŸ¥æ‰¾å’Œåˆ é™¤ï¼šO(1)
    * é“¾è¡¨èŠ‚ç‚¹æ’å…¥/åˆ é™¤ï¼šO(1)
    * HashSet æ“ä½œï¼šO(1)
  - getMaxKey/getMinKeyï¼š
    * é“¾è¡¨å¤´å°¾è®¿é—®ï¼šO(1)
    * HashSet è·å–å…ƒç´ ï¼šO(1)

- **ç©ºé—´å¤æ‚åº¦**ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯ä¸åŒå­—ç¬¦ä¸²çš„æ•°é‡
  - å“ˆå¸Œè¡¨å­˜å‚¨æ‰€æœ‰å­—ç¬¦ä¸²åˆ°èŠ‚ç‚¹çš„æ˜ å°„ï¼šO(n)
  - åŒå‘é“¾è¡¨èŠ‚ç‚¹å­˜å‚¨æ‰€æœ‰è®¡æ•°å€¼ï¼šO(k)ï¼Œk æ˜¯ä¸åŒçš„è®¡æ•°å€¼æ•°é‡
  - æ¯ä¸ªèŠ‚ç‚¹çš„ HashSet å­˜å‚¨å­—ç¬¦ä¸²ï¼šO(n)

---

## LeetCode é¢˜è§£

æœ¬é¢˜è§£æ˜¯ LeetCode ç³»åˆ—é¢˜è§£çš„ä¸€éƒ¨åˆ†ã€‚è¯¥ç³»åˆ—é¢˜è§£è‡´åŠ›äºå¸®åŠ©ç¨‹åºå‘˜æ›´å¥½åœ°ç†è§£å’ŒæŒæ¡ç®—æ³•æ€ç»´ï¼Œå†…å®¹åŒ…å«è¯¦ç»†çš„è§£é¢˜æ€è·¯åˆ†æã€å›¾æ–‡å¹¶èŒ‚çš„ç¤ºä¾‹è®²è§£å’Œå®Œæ•´çš„ä»£ç å®ç°ã€‚

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode æœ€å…¨é¢˜è§£](https://github.com/LjyYano/LeetCode)ï¼šæŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿ Star â­ï¸ å…³æ³¨ï¼Œä¸€èµ·æ¢è®¨ç®—æ³•ä¹‹ç¾ã€‚ 
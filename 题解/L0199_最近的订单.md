---
title: æœ€è¿‘çš„è®¢å•
date: 2024-02-09
---

## é¢˜ç›®æè¿°

**ğŸ”— é¢˜ç›®**ï¼š[æœ€è¿‘çš„è®¢å•](https://leetcode.cn/problems/recent-orders/)  
**ğŸ·ï¸ æ ‡ç­¾**ï¼š`æ•°æ®åº“`  
**ğŸŸ¡ éš¾åº¦**ï¼š`ä¸­ç­‰`  

è¡¨ï¼šCustomers
```
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| customer_id   | int     |
| name          | varchar |
+---------------+---------+
```
customer_id æ˜¯è¯¥è¡¨ä¸»é”®ã€‚
è¯¥è¡¨åŒ…å«æ¶ˆè´¹è€…çš„ä¿¡æ¯ã€‚

è¡¨ï¼šOrders
```
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| order_id      | int     |
| order_date    | date    |
| customer_id   | int     |
| cost          | int     |
+---------------+---------+
```
order_id æ˜¯è¯¥è¡¨ä¸»é”®ã€‚
è¯¥è¡¨åŒ…å«è®¢å•çš„ä¿¡æ¯ã€‚
customer_id æ˜¯ Customers è¡¨ä¸­ customer_id çš„å¤–é”®ã€‚

å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾åˆ°æ¯ä¸ªç”¨æˆ·çš„æœ€è¿‘ä¸€ç¬”è®¢å•ã€‚è¿”å›ç»“æœæŒ‰ç…§ customer_name å‡åºæ’åˆ—ã€‚

ç¤ºä¾‹ 1ï¼š
è¾“å…¥ï¼š
Customers è¡¨ï¼š
```
+-------------+-----------+
| customer_id | name      |
+-------------+-----------+
| 1           | Winston   |
| 2           | Jonathan  |
| 3           | Annabelle |
| 4           | Marwan    |
+-------------+-----------+
```

Orders è¡¨ï¼š
```
+----------+------------+-------------+------+
| order_id | order_date | customer_id | cost |
+----------+------------+-------------+------+
| 1        | 2020-07-31 | 1           | 30   |
| 2        | 2020-07-30 | 2           | 40   |
| 3        | 2020-07-31 | 3           | 70   |
| 4        | 2020-07-29 | 4           | 100  |
| 5        | 2020-06-10 | 1           | 1010 |
| 6        | 2020-08-01 | 2           | 102  |
| 7        | 2020-08-01 | 3           | 111  |
| 8        | 2020-08-03 | 1           | 99   |
| 9        | 2020-08-07 | 2           | 32   |
| 10       | 2020-07-15 | 1           | 2    |
+----------+------------+-------------+------+
```

è¾“å‡ºï¼š
```
+---------------+-------------+----------+------------+
| customer_name | customer_id | order_id | order_date |
+---------------+-------------+----------+------------+
| Annabelle     | 3           | 7        | 2020-08-01 |
| Jonathan      | 2           | 9        | 2020-08-07 |
| Marwan        | 4           | 4        | 2020-07-29 |
| Winston       | 1           | 8        | 2020-08-03 |
+---------------+-------------+----------+------------+
```

è§£é‡Šï¼š
- Annabelle çš„æœ€åä¸€ç¬”è®¢å•æ˜¯è®¢å• 7ï¼Œå‘ç”Ÿåœ¨ 2020-08-01
- Jonathan çš„æœ€åä¸€ç¬”è®¢å•æ˜¯è®¢å• 9ï¼Œå‘ç”Ÿåœ¨ 2020-08-07
- Marwan çš„æœ€åä¸€ç¬”è®¢å•æ˜¯è®¢å• 4ï¼Œå‘ç”Ÿåœ¨ 2020-07-29
- Winston çš„æœ€åä¸€ç¬”è®¢å•æ˜¯è®¢å• 8ï¼Œå‘ç”Ÿåœ¨ 2020-08-03

---

## è§£é¢˜æ€è·¯

### SQL è¿æ¥å’Œå­æŸ¥è¯¢å®ç°

#### ğŸ“ æ ¸å¿ƒæ€æƒ³
è¦æ‰¾åˆ°æ¯ä¸ªç”¨æˆ·çš„æœ€è¿‘è®¢å•ï¼Œæˆ‘ä»¬éœ€è¦ï¼š
1. ä½¿ç”¨ JOIN è¿æ¥ Customers å’Œ Orders è¡¨
2. ä½¿ç”¨å­æŸ¥è¯¢æ‰¾å‡ºæ¯ä¸ªå®¢æˆ·çš„æœ€è¿‘è®¢å•æ—¥æœŸ
3. ä½¿ç”¨ WHERE å­å¥ç­›é€‰å‡ºæœ€è¿‘çš„è®¢å•
4. æŒ‰å®¢æˆ·åç§°å‡åºæ’åºç»“æœ

#### ğŸ› ï¸ å®ç°æ­¥éª¤
1. ä½¿ç”¨ JOIN è¿æ¥ä¸¤ä¸ªè¡¨ï¼Œè·å–å®¢æˆ·ä¿¡æ¯å’Œè®¢å•ä¿¡æ¯
2. ä½¿ç”¨å­æŸ¥è¯¢ï¼š
   - GROUP BY customer_id åˆ†ç»„
   - MAX(order_date) è·å–æ¯ä¸ªå®¢æˆ·çš„æœ€è¿‘è®¢å•æ—¥æœŸ
3. ä½¿ç”¨ WHERE å­å¥åŒ¹é…æœ€è¿‘è®¢å•
4. ä½¿ç”¨ ORDER BY æŒ‰å®¢æˆ·åç§°æ’åº

#### ğŸ§© ç¤ºä¾‹åˆ†æ
ä»¥ç¤ºä¾‹æ•°æ®ä¸ºä¾‹ï¼Œåˆ†ææŸ¥è¯¢è¿‡ç¨‹ï¼š

1. é¦–å…ˆï¼Œæ‰¾å‡ºæ¯ä¸ªå®¢æˆ·çš„æœ€è¿‘è®¢å•æ—¥æœŸï¼š

| customer_id | æœ€è¿‘è®¢å•æ—¥æœŸ |
|------------|------------|
| 1          | 2020-08-03 |
| 2          | 2020-08-07 |
| 3          | 2020-08-01 |
| 4          | 2020-07-29 |

2. ç„¶åï¼Œå°†è¿™äº›æ—¥æœŸä¸åŸå§‹è®¢å•åŒ¹é…ï¼š

| customer_id | name      | order_id | order_date | æ˜¯å¦æœ€è¿‘è®¢å• |
|------------|-----------|----------|------------|-------------|
| 1          | Winston   | 8        | 2020-08-03 | æ˜¯          |
| 2          | Jonathan  | 9        | 2020-08-07 | æ˜¯          |
| 3          | Annabelle | 7        | 2020-08-01 | æ˜¯          |
| 4          | Marwan    | 4        | 2020-07-29 | æ˜¯          |

3. æœ€åï¼ŒæŒ‰å®¢æˆ·åç§°æ’åºï¼š
```
+---------------+-------------+----------+------------+
| customer_name | customer_id | order_id | order_date |
+---------------+-------------+----------+------------+
| Annabelle     | 3           | 7        | 2020-08-01 |
| Jonathan      | 2           | 9        | 2020-08-07 |
| Marwan        | 4           | 4        | 2020-07-29 |
| Winston       | 1           | 8        | 2020-08-03 |
+---------------+-------------+----------+------------+
```

---

## ä»£ç å®ç°

å®Œæ•´çš„å¯è¿è¡Œä»£ç ï¼š[L0199_RecentOrders.sql](../src/main/sql/L0199_RecentOrders.sql)

```sql
SELECT name as customer_name,
    customer_id,
    order_id,
    order_date
FROM Orders o
JOIN Customers c ON o.customer_id = c.customer_id
WHERE (customer_id, order_date) IN (
    SELECT customer_id, MAX(order_date)
    FROM Orders
    GROUP BY customer_id
)
ORDER BY name ASC
```

---

## å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼šO(n log n)
  - éœ€è¦å¯¹è®¢å•æ—¥æœŸè¿›è¡Œæ’åºå’Œåˆ†ç»„
  - n æ˜¯è®¢å•è¡¨ä¸­çš„è®°å½•æ•°
  - æ’åºæ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(n log n)

- **ç©ºé—´å¤æ‚åº¦**ï¼šO(n)
  - éœ€è¦å­˜å‚¨æ¯ä¸ªå®¢æˆ·çš„æœ€è¿‘è®¢å•æ—¥æœŸ
  - n æ˜¯å®¢æˆ·æ•°é‡

---

## LeetCode é¢˜è§£

æœ¬é¢˜è§£æ˜¯ LeetCode ç³»åˆ—é¢˜è§£çš„ä¸€éƒ¨åˆ†ã€‚è¯¥ç³»åˆ—é¢˜è§£è‡´åŠ›äºå¸®åŠ©ç¨‹åºå‘˜æ›´å¥½åœ°ç†è§£å’ŒæŒæ¡ç®—æ³•æ€ç»´ï¼Œå†…å®¹åŒ…å«è¯¦ç»†çš„è§£é¢˜æ€è·¯åˆ†æã€å›¾æ–‡å¹¶èŒ‚çš„ç¤ºä¾‹è®²è§£å’Œå®Œæ•´çš„ä»£ç å®ç°ã€‚

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode æœ€å…¨é¢˜è§£](https://github.com/LjyYano/LeetCode)ï¼šæŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿ Star â­ï¸ å…³æ³¨ï¼Œä¸€èµ·æ¢è®¨ç®—æ³•ä¹‹ç¾ã€‚ 
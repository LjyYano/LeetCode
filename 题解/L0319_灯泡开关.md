---
title: 灯泡开关
date: 2024-02-10
---

## 题目描述

**🔗 题目**：[灯泡开关](https://leetcode.cn/problems/bulb-switcher/)  
**🏷️ 标签**：`数学` `脑筋急转弯`  
**🟡 难度**：`中等`  

初始时有 `n` 个灯泡处于关闭状态。第一轮，你将会打开所有灯泡。第二轮，你将会每两个灯泡关闭第二个。

第三轮，你每三个灯泡就切换第三个灯泡的开关（即，打开变关闭，关闭变打开）。第 `i` 轮，你每 `i` 个灯泡就切换第 `i` 个灯泡的开关。直到第 `n` 轮，你只需要切换最后一个灯泡的开关。

找出并返回 `n` 轮后有多少个亮着的灯泡。

**示例 1：**

![img](https://assets.leetcode.com/uploads/2020/11/05/bulb.jpg)

```
输入：n = 3
输出：1
解释：
初始时, 灯泡状态 [关闭, 关闭, 关闭]
第一轮后, 灯泡状态 [开启, 开启, 开启]
第二轮后, 灯泡状态 [开启, 关闭, 开启]
第三轮后, 灯泡状态 [开启, 关闭, 关闭]
你应该返回 1，因为只有一个灯泡还亮着。
```

**示例 2：**
```
输入：n = 0
输出：0
```

**示例 3：**
```
输入：n = 1
输出：1
```

**提示：**
- `0 <= n <= 10⁹`

---

## 解题思路

### 数学规律分析

#### 📝 核心思想

这道题的关键在于理解每个灯泡的开关次数与其位置的关系。对于第 k 个灯泡，它会在第 i 轮被切换当且仅当 k 能被 i 整除。因此，第 k 个灯泡被切换的次数等于它的因子个数。

例如，对于第 6 个灯泡，它的因子有 1、2、3、6，所以会被切换 4 次。由于每次切换都会改变灯泡的状态（开→关或关→开），所以：
- 如果灯泡被切换奇数次，最终会是亮着的
- 如果灯泡被切换偶数次，最终会是关闭的

那么问题就转化为：找出 1 到 n 中有多少个数的因子个数是奇数个。

#### 🛠️ 实现步骤

1. 分析一个数的因子个数为什么会是奇数：
   - 一个数的因子总是成对出现的，比如 12 的因子：1×12、2×6、3×4
   - 只有平方数的因子个数是奇数的，因为平方根会和自己配对
   - 例如 16 的因子：1×16、2×8、4×4，其中 4 只计算一次

2. 因此，问题进一步简化为：
   - 找出 1 到 n 中完全平方数的个数
   - 即找出最大的 k，使得 k² ≤ n
   - 答案就是 ⌊√n⌋

#### 🧩 示例分析

以 n = 16 为例，分析每个位置的灯泡最终状态：

| 位置 | 因子 | 因子个数 | 最终状态 |
|-----|------|---------|---------|
| 1 | 1 | 1 | 亮 |
| 2 | 1, 2 | 2 | 灭 |
| 3 | 1, 3 | 2 | 灭 |
| 4 | 1, 2, 4 | 3 | 亮 |
| 5 | 1, 5 | 2 | 灭 |
| 6 | 1, 2, 3, 6 | 4 | 灭 |
| 7 | 1, 7 | 2 | 灭 |
| 8 | 1, 2, 4, 8 | 4 | 灭 |
| 9 | 1, 3, 9 | 3 | 亮 |
| ... | ... | ... | ... |
| 16 | 1, 2, 4, 8, 16 | 5 | 亮 |

可以看到，只有位置 1、4、9、16（完全平方数）的灯泡最终是亮着的。
因此，对于 n = 16，答案是 4（⌊√16⌋ = 4）。

---

## 代码实现

完整的可运行代码：[L0319_BulbSwitcher.java](../src/main/java/L0319_BulbSwitcher.java)

```java
public int bulbSwitch(int n) {
    // 返回 n 的平方根向下取整
    return (int) Math.sqrt(n);
}
```

---

## 复杂度分析

- **时间复杂度**: O(1)。只需要计算一次平方根。
- **空间复杂度**: O(1)。只使用了常数额外空间。

---

## LeetCode 题解

本题解是 LeetCode 系列题解的一部分。该系列题解致力于帮助程序员更好地理解和掌握算法思维，内容包含详细的解题思路分析、图文并茂的示例讲解和完整的代码实现。

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode 最全题解](https://github.com/LjyYano/LeetCode)：持续更新中，欢迎 Star ⭐️ 关注，一起探讨算法之美。 
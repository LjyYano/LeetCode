---
title: 计数质数
date: 2025-02-10
---

## 题目描述

**🔗 题目**：[计数质数](https://leetcode.cn/problems/count-primes/)  
**🏷️ 标签**：`数学` `数论` `埃氏筛`  
**🟡 难度**：`中等`  

给定整数 n ，返回所有小于非负整数 n 的质数的数量。

**示例 1：**
```
输入：n = 10
输出：4
解释：小于 10 的质数一共有 4 个, 它们是 2, 3, 5, 7 。
```

**示例 2：**
```
输入：n = 0
输出：0
```

**示例 3：**
```
输入：n = 1
输出：0
```

**提示：**
- 0 <= n <= 5 * 10⁶

---

## 解题思路

### 埃拉托斯特尼筛法

#### 📝 核心思想
埃拉托斯特尼筛法是一个古老而高效的质数筛选算法。其核心思想是：从 2 开始，将每个质数的倍数都标记为合数。这样在遍历过程中，未被标记的数就是质数。

#### 🛠️ 实现步骤
1. 特殊情况处理：
   - 如果 n <= 2，直接返回 0，因为没有小于 2 的质数
2. 初始化标记数组：
   - 创建一个长度为 n 的布尔数组，用于标记非质数
   - 初始时假设所有数都是质数（false）
3. 执行筛选：
   - 从 2 开始遍历到 n-1
   - 每找到一个质数，就将其所有倍数标记为非质数
   - 统计未被标记的数的个数
4. 返回质数计数

#### 🧩 示例分析
以 n = 10 为例，演示筛选过程：

1. 初始状态（F 表示质数，T 表示非质数）：
```
索引：[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
标记：[F, F, F, F, F, F, F, F, F, F]
```

2. 处理 2 的倍数：
```
索引：[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
标记：[F, F, F, F, T, F, T, F, T, F]
解释：4、6、8 被标记为非质数
```

3. 处理 3 的倍数：
```
索引：[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
标记：[F, F, F, F, T, F, T, F, T, T]
解释：9 被标记为非质数
```

4. 处理 5 和 7：
   - 它们的倍数都超过了 n，无需处理

5. 最终结果：
   - 质数有：2、3、5、7
   - 数量：4

---

## 代码实现

完整的可运行代码：[L0204_CountPrimes.java](../src/main/java/L0204_CountPrimes.java)

```java
public int countPrimes(int n) {
    // 使用埃氏筛法
    if (n <= 2) {
        return 0;
    }
    
    // 初始化标记数组，默认都是质数
    boolean[] notPrime = new boolean[n];
    int count = 0;
    
    // 从 2 开始遍历到 sqrt(n)
    for (int i = 2; i < n; i++) {
        if (!notPrime[i]) {
            count++;
            // 将当前质数的倍数都标记为非质数
            if ((long) i * i < n) {
                for (int j = i * i; j < n; j += i) {
                    notPrime[j] = true;
                }
            }
        }
    }
    
    return count;
}
```

---

## 复杂度分析

- **时间复杂度**：O(n log log n)
  - 外层循环需要 O(n) 的时间
  - 内层循环的总时间复杂度是 O(n log log n)
  - 这是因为每个合数会被其最小质因子筛掉

- **空间复杂度**：O(n)
  - 需要一个长度为 n 的布尔数组来标记数字是否为质数
  - 除此之外只需要常数级的额外空间

---

## LeetCode 题解

本题解是 LeetCode 系列题解的一部分。该系列题解致力于帮助程序员更好地理解和掌握算法思维，内容包含详细的解题思路分析、图文并茂的示例讲解和完整的代码实现。

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode 最全题解](https://github.com/LjyYano/LeetCode)：持续更新中，欢迎 Star ⭐️ 关注，一起探讨算法之美。 
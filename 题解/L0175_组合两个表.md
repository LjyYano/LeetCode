---
title: 组合两个表
date: 2025-02-09
---

## 题目描述

**🔗 题目**：[组合两个表](https://leetcode.cn/problems/combine-two-tables/)  
**🏷️ 标签**：`数据库`  
**🟢 难度**：`简单`  

表: Person
```
+-------------+---------+
| 列名         | 类型     |
+-------------+---------+
| PersonId    | int     |
| FirstName   | varchar |
| LastName    | varchar |
+-------------+---------+
```
personId 是该表的主键列。
该表包含一些人的 ID 和他们的姓和名的信息。

表: Address
```
+-------------+---------+
| 列名         | 类型    |
+-------------+---------+
| AddressId   | int     |
| PersonId    | int     |
| City        | varchar |
| State       | varchar |
+-------------+---------+
```
addressId 是该表的主键列。
该表的每一行都包含一个 ID = PersonId 的人的城市和州的信息。

编写一个SQL查询来报告 Person 表中每个人的姓、名、城市和州。如果 personId 的地址不在 Address 表中，则报告为空。

以 任意顺序 返回结果表。

查询结果格式如下所示。

示例 1:
输入: 
Person表:
```
+----------+----------+-----------+
| personId | lastName | firstName |
+----------+----------+-----------+
| 1        | Wang     | Allen     |
| 2        | Alice    | Bob       |
+----------+----------+-----------+
```
Address表:
```
+-----------+----------+---------------+------------+
| addressId | personId | city          | state      |
+-----------+----------+---------------+------------+
| 1         | 2        | New York City | New York   |
| 2         | 3        | Leetcode      | California |
+-----------+----------+---------------+------------+
```
输出: 
```
+-----------+----------+---------------+----------+
| firstName | lastName | city          | state    |
+-----------+----------+---------------+----------+
| Allen     | Wang     | null          | null     |
| Bob       | Alice    | New York City | New York |
+-----------+----------+---------------+----------+
```
解释: 
地址表中没有 personId = 1 的地址，所以它们的城市和州返回 null。
addressId = 1 包含了 personId = 2 的地址信息。

---

## 解题思路

### SQL 查询分析

#### 📝 核心思想
这道题目的核心是要理解如何处理两个表之间的关联查询，特别是在某些记录可能没有对应关联数据的情况下。我们需要使用外连接（LEFT JOIN）来确保即使在 Address 表中找不到对应的地址信息，也能显示 Person 表中的所有人员信息。

#### 🛠️ 实现步骤
1. 选择基表：因为我们需要显示所有人的信息，所以应该以 Person 表为基表
2. 选择连接类型：使用 LEFT JOIN 确保显示所有人的信息，即使没有对应的地址
3. 指定连接条件：使用 personId 作为连接键
4. 选择需要显示的字段：firstName、lastName、city、state

#### 🧩 示例分析
让我们通过示例数据来分析 SQL 查询的执行过程：

1. 首先，从 Person 表开始：
```
+----------+----------+-----------+
| personId | lastName | firstName |
+----------+----------+-----------+
| 1        | Wang     | Allen     |  ← 第一条记录
| 2        | Alice    | Bob       |  ← 第二条记录
+----------+----------+-----------+
```

2. 对于每条记录，尝试在 Address 表中找到匹配的记录：
- personId = 1 (Allen Wang)：在 Address 表中找不到匹配记录 → city 和 state 为 null
- personId = 2 (Bob Alice)：在 Address 表中找到匹配记录 → 使用对应的 city 和 state

3. 最终结果：
```
+-----------+----------+---------------+----------+
| firstName | lastName | city          | state    |
+-----------+----------+---------------+----------+
| Allen     | Wang     | null          | null     | ← 没有匹配的地址
| Bob       | Alice    | New York City | New York | ← 有匹配的地址
+-----------+----------+---------------+----------+
```

---

## 代码实现

完整的可运行代码：[L0175_CombineTwoTables.java](../src/main/java/L0175_CombineTwoTables.java)

```java
public String getSQL() {
    return "SELECT p.firstName, p.lastName, a.city, a.state " +
           "FROM Person p " +
           "LEFT JOIN Address a ON p.personId = a.personId";
}
```

---

## 复杂度分析

- **时间复杂度**：O(n)，其中 n 是 Person 表的记录数。对于每个人，我们都需要在 Address 表中查找对应的地址信息。
- **空间复杂度**：O(n)，需要存储所有人的信息及其对应的地址（如果有的话）。

---

## LeetCode 题解

本题解是 LeetCode 系列题解的一部分。该系列题解致力于帮助程序员更好地理解和掌握算法思维，内容包含详细的解题思路分析、图文并茂的示例讲解和完整的代码实现。

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode 最全题解](https://github.com/LjyYano/LeetCode)：持续更新中，欢迎 Star ⭐️ 关注，一起探讨算法之美。 
---
title: åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹
date: 2025-02-10
---

## é¢˜ç›®æè¿°

**ğŸ”— é¢˜ç›®**ï¼š[åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹](https://leetcode.cn/problems/range-sum-query-mutable/)  
**ğŸ·ï¸ æ ‡ç­¾**ï¼š`è®¾è®¡` `æ ‘çŠ¶æ•°ç»„` `çº¿æ®µæ ‘` `æ•°ç»„`  
**ğŸŸ¡ éš¾åº¦**ï¼š`ä¸­ç­‰`  

ç»™ä½ ä¸€ä¸ªæ•°ç»„ numsï¼Œè¯·ä½ å®Œæˆä¸¤ç±»æŸ¥è¯¢ã€‚

1. å…¶ä¸­ä¸€ç±»æŸ¥è¯¢è¦æ±‚ æ›´æ–° æ•°ç»„ nums ä¸‹æ ‡å¯¹åº”çš„å€¼
2. å¦ä¸€ç±»æŸ¥è¯¢è¦æ±‚è¿”å›æ•°ç»„ nums ä¸­ç´¢å¼• left å’Œç´¢å¼• right ä¹‹é—´ï¼ˆåŒ…å«ï¼‰çš„ nums å…ƒç´ çš„ å’Œï¼Œå…¶ä¸­ left <= right

å®ç° NumArray ç±»ï¼š

- NumArray(int[] nums) ç”¨æ•´æ•°æ•°ç»„ nums åˆå§‹åŒ–å¯¹è±¡
- void update(int index, int val) å°† nums[index] çš„å€¼ æ›´æ–° ä¸º val
- int sumRange(int left, int right) è¿”å›æ•°ç»„ nums ä¸­ç´¢å¼• left å’Œç´¢å¼• right ä¹‹é—´ï¼ˆåŒ…å«ï¼‰çš„ nums å…ƒç´ çš„ å’Œï¼ˆå³ï¼Œnums[left] + nums[left + 1], ..., nums[right]ï¼‰

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼š
["NumArray", "sumRange", "update", "sumRange"]
[[[1, 3, 5]], [0, 2], [1, 2], [0, 2]]
è¾“å‡ºï¼š
[null, 9, null, 8]

è§£é‡Šï¼š
NumArray numArray = new NumArray([1, 3, 5]);
numArray.sumRange(0, 2); // è¿”å› 1 + 3 + 5 = 9
numArray.update(1, 2);   // nums = [1,2,5]
numArray.sumRange(0, 2); // è¿”å› 1 + 2 + 5 = 8
```

æç¤ºï¼š
- 1 <= nums.length <= 3 * 10â´
- -100 <= nums[i] <= 100
- 0 <= index < nums.length
- -100 <= val <= 100
- 0 <= left <= right < nums.length
- è°ƒç”¨ update å’Œ sumRange æ–¹æ³•æ¬¡æ•°ä¸å¤§äº 3 * 10â´

---

## è§£é¢˜æ€è·¯
### çº¿æ®µæ ‘

#### ğŸ“ æ ¸å¿ƒæ€æƒ³
çº¿æ®µæ ‘æ˜¯ä¸€ç§äºŒå‰æ ‘å½¢æ•°æ®ç»“æ„ï¼Œç”¨äºé«˜æ•ˆåœ°è§£å†³åŒºé—´æŸ¥è¯¢å’Œæ›´æ–°é—®é¢˜ã€‚æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªåŒºé—´ï¼Œçˆ¶èŠ‚ç‚¹çš„åŒºé—´æ˜¯å­èŠ‚ç‚¹åŒºé—´çš„å¹¶é›†ã€‚çº¿æ®µæ ‘çš„ç‰¹ç‚¹æ˜¯ï¼š
1. å¯ä»¥åœ¨ O(log n) æ—¶é—´å†…å®Œæˆå•ç‚¹æ›´æ–°
2. å¯ä»¥åœ¨ O(log n) æ—¶é—´å†…å®ŒæˆåŒºé—´æŸ¥è¯¢
3. ç©ºé—´å¤æ‚åº¦ä¸º O(n)ï¼Œå…¶ä¸­ n æ˜¯åŸæ•°ç»„çš„é•¿åº¦

#### ğŸ› ï¸ å®ç°æ­¥éª¤
1. æ„å»ºçº¿æ®µæ ‘ï¼š
   - åˆ›å»ºçº¿æ®µæ ‘èŠ‚ç‚¹ç±»ï¼ŒåŒ…å«åŒºé—´èµ·ç‚¹ã€ç»ˆç‚¹ã€åŒºé—´å’Œã€å·¦å³å­èŠ‚ç‚¹
   - é€’å½’æ„å»ºæ ‘ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªåŒºé—´
   - å¶å­èŠ‚ç‚¹å­˜å‚¨å•ä¸ªå…ƒç´ çš„å€¼
   - éå¶å­èŠ‚ç‚¹çš„å€¼ä¸ºå…¶å·¦å³å­èŠ‚ç‚¹å€¼çš„å’Œ

2. æ›´æ–°æ“ä½œï¼š
   - ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€’å½’æŸ¥æ‰¾ç›®æ ‡ä½ç½®
   - æ›´æ–°å¶å­èŠ‚ç‚¹çš„å€¼
   - è‡ªåº•å‘ä¸Šæ›´æ–°çˆ¶èŠ‚ç‚¹çš„åŒºé—´å’Œ

3. åŒºé—´æŸ¥è¯¢ï¼š
   - ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€’å½’å¤„ç†æŸ¥è¯¢åŒºé—´
   - å¦‚æœå½“å‰èŠ‚ç‚¹åŒºé—´å®Œå…¨åŒ…å«åœ¨æŸ¥è¯¢åŒºé—´å†…ï¼Œç›´æ¥è¿”å›èŠ‚ç‚¹å€¼
   - å¦åˆ™ï¼Œå°†æŸ¥è¯¢åŒºé—´åˆ†å‰²ï¼Œé€’å½’æŸ¥è¯¢å·¦å³å­æ ‘å¹¶åˆå¹¶ç»“æœ

#### ğŸ§© ç¤ºä¾‹åˆ†æ
ä»¥æ•°ç»„ [1, 3, 5] ä¸ºä¾‹ï¼Œè®©æˆ‘ä»¬è¯¦ç»†åˆ†æçº¿æ®µæ ‘çš„æ“ä½œè¿‡ç¨‹ï¼š

1. åˆå§‹åŒ–çº¿æ®µæ ‘ï¼š
```
                [0,2] sum=9
                /         \
        [0,1] sum=4     [2,2] sum=5
        /         \
[0,0] sum=1  [1,1] sum=3
```

2. æ‰§è¡Œ sumRange(0, 2) çš„è¿‡ç¨‹ï¼š
| æ­¥éª¤ | å½“å‰èŠ‚ç‚¹ | æ“ä½œ | ç»“æœ |
|-----|---------|------|-----|
| 1 | [0,2] | æ£€æŸ¥åŒºé—´ [0,2] | å®Œå…¨åŒ¹é…ï¼Œè¿”å› 9 |

3. æ‰§è¡Œ update(1, 2) çš„è¿‡ç¨‹ï¼š
| æ­¥éª¤ | å½“å‰èŠ‚ç‚¹ | æ“ä½œ | æ›´æ–°åçš„å’Œ |
|-----|---------|------|-----------|
| 1 | [0,2] | å‘ä¸‹æŸ¥æ‰¾ç´¢å¼• 1 | - |
| 2 | [0,1] | å‘ä¸‹æŸ¥æ‰¾ç´¢å¼• 1 | - |
| 3 | [1,1] | æ›´æ–°å€¼ä¸º 2 | 2 |
| 4 | [0,1] | æ›´æ–°å’Œï¼š1 + 2 | 3 |
| 5 | [0,2] | æ›´æ–°å’Œï¼š3 + 5 | 8 |

æ›´æ–°åçš„çº¿æ®µæ ‘ï¼š
```
                [0,2] sum=8
                /         \
        [0,1] sum=3     [2,2] sum=5
        /         \
[0,0] sum=1  [1,1] sum=2
```

4. æ‰§è¡Œ sumRange(0, 2) çš„è¿‡ç¨‹ï¼š
| æ­¥éª¤ | å½“å‰èŠ‚ç‚¹ | æ“ä½œ | ç»“æœ |
|-----|---------|------|-----|
| 1 | [0,2] | æ£€æŸ¥åŒºé—´ [0,2] | å®Œå…¨åŒ¹é…ï¼Œè¿”å› 8 |

é€šè¿‡è¿™ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š
- çº¿æ®µæ ‘èƒ½å¤Ÿé«˜æ•ˆåœ°ç»´æŠ¤åŒºé—´ä¿¡æ¯
- æ¯æ¬¡æ›´æ–°åªéœ€è¦ä¿®æ”¹ä»å¶å­åˆ°æ ¹çš„ä¸€æ¡è·¯å¾„
- åŒºé—´æŸ¥è¯¢å¯ä»¥åˆ©ç”¨èŠ‚ç‚¹å­˜å‚¨çš„åŒºé—´å’Œå¿«é€Ÿå¾—åˆ°ç»“æœ

---

## ä»£ç å®ç°

å®Œæ•´çš„å¯è¿è¡Œä»£ç ï¼š[L0307_RangeSumQueryMutable.java](../src/main/java/L0307_RangeSumQueryMutable.java)

```java
public class L0307_RangeSumQueryMutable {
    // çº¿æ®µæ ‘èŠ‚ç‚¹ç±»
    private static class SegmentTreeNode {
        private int start, end;
        private SegmentTreeNode left, right;
        private int sum;

        public SegmentTreeNode(int start, int end) {
            this.start = start;
            this.end = end;
            this.left = null;
            this.right = null;
            this.sum = 0;
        }
    }

    private SegmentTreeNode root = null;

    // æ„å»ºçº¿æ®µæ ‘
    private SegmentTreeNode buildTree(int[] nums, int start, int end) {
        if (start > end) {
            return null;
        }
        
        SegmentTreeNode node = new SegmentTreeNode(start, end);
        
        if (start == end) {
            node.sum = nums[start];
            return node;
        }
        
        int mid = start + (end - start) / 2;
        node.left = buildTree(nums, start, mid);
        node.right = buildTree(nums, mid + 1, end);
        node.sum = node.left.sum + node.right.sum;
        
        return node;
    }

    // æ›´æ–°çº¿æ®µæ ‘ä¸­çš„å€¼
    private void updateTree(SegmentTreeNode node, int index, int val) {
        if (node.start == node.end) {
            node.sum = val;
            return;
        }
        
        int mid = node.start + (node.end - node.start) / 2;
        if (index <= mid) {
            updateTree(node.left, index, val);
        } else {
            updateTree(node.right, index, val);
        }
        
        node.sum = node.left.sum + node.right.sum;
    }

    // æŸ¥è¯¢åŒºé—´å’Œ
    private int queryTree(SegmentTreeNode node, int left, int right) {
        if (node.start == left && node.end == right) {
            return node.sum;
        }
        
        int mid = node.start + (node.end - node.start) / 2;
        if (right <= mid) {
            return queryTree(node.left, left, right);
        } else if (left > mid) {
            return queryTree(node.right, left, right);
        } else {
            return queryTree(node.left, left, mid) + queryTree(node.right, mid + 1, right);
        }
    }
}
```

---

## å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š
  - æ„å»ºçº¿æ®µæ ‘ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯æ•°ç»„çš„é•¿åº¦ã€‚éœ€è¦ä¸ºæ¯ä¸ªæ•°ç»„å…ƒç´ åˆ›å»ºå¶å­èŠ‚ç‚¹ï¼Œç„¶åè‡ªåº•å‘ä¸Šæ„å»ºçˆ¶èŠ‚ç‚¹ã€‚
  - å•ç‚¹æ›´æ–°ï¼šO(log n)ï¼Œæ¯æ¬¡æ›´æ–°åªéœ€è¦ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„ä¸€æ¡è·¯å¾„ï¼Œæ ‘çš„é«˜åº¦ä¸º log nã€‚
  - åŒºé—´æŸ¥è¯¢ï¼šO(log n)ï¼Œæ¯æ¬¡æŸ¥è¯¢æœ€å¤šå°†åŒºé—´åˆ†æˆ O(log n) ä¸ªéƒ¨åˆ†ã€‚

- **ç©ºé—´å¤æ‚åº¦**ï¼šO(n)
  - çº¿æ®µæ ‘éœ€è¦å­˜å‚¨ 2n-1 ä¸ªèŠ‚ç‚¹ï¼ˆn ä¸ªå¶å­èŠ‚ç‚¹å’Œ n-1 ä¸ªå†…éƒ¨èŠ‚ç‚¹ï¼‰
  - å®é™…å®ç°ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œé€šå¸¸ä¼šåˆ†é… 4n çš„ç©ºé—´

---

## LeetCode é¢˜è§£

æœ¬é¢˜è§£æ˜¯ LeetCode ç³»åˆ—é¢˜è§£çš„ä¸€éƒ¨åˆ†ã€‚è¯¥ç³»åˆ—é¢˜è§£è‡´åŠ›äºå¸®åŠ©ç¨‹åºå‘˜æ›´å¥½åœ°ç†è§£å’ŒæŒæ¡ç®—æ³•æ€ç»´ï¼Œå†…å®¹åŒ…å«è¯¦ç»†çš„è§£é¢˜æ€è·¯åˆ†æã€å›¾æ–‡å¹¶èŒ‚çš„ç¤ºä¾‹è®²è§£å’Œå®Œæ•´çš„ä»£ç å®ç°ã€‚

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode æœ€å…¨é¢˜è§£](https://github.com/LjyYano/LeetCode)ï¼šæŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿ Star â­ï¸ å…³æ³¨ï¼Œä¸€èµ·æ¢è®¨ç®—æ³•ä¹‹ç¾ã€‚ 
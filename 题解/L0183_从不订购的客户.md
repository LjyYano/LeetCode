---
title: 从不订购的客户
date: 2025-02-09
---

## 题目描述

**🔗 题目**：[从不订购的客户](https://leetcode.cn/problems/customers-who-never-order/)  
**🏷️ 标签**：`数据库`  
**🟢 难度**：`简单`  

表: Customers
```
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| id          | int     |
| name        | varchar |
+-------------+---------+
```
id 是该表的主键。  
该表包含客户的 ID 和姓名。  

表: Orders
```
+-------------+------+
| Column Name | Type |
+-------------+------+
| id          | int  |
| customerId  | int  |
+-------------+------+
```
id 是该表的主键。  
customerId 是 Customers 表中 ID 的外键。  
该表包含客户的订单信息。  

编写一个 SQL 查询，报告所有从不订购任何东西的客户的姓名。  

以 任意顺序 返回结果表。  

查询结果格式如下所示。  

示例 1：  
输入：  
Customers 表：
```
+----+-------+
| id | name  |
+----+-------+
| 1  | Joe   |
| 2  | Henry |
| 3  | Sam   |
| 4  | Max   |
+----+-------+
```
Orders 表：
```
+----+------------+
| id | customerId |
+----+------------+
| 1  | 3          |
| 2  | 1          |
+----+------------+
```
输出：
```
+-----------+
| Customers |
+-----------+
| Henry     |
| Max       |
+-----------+
```
解释：  
Henry 和 Max 从没有下过订单。

---

## 解题思路

### NOT IN 子查询

#### 📝 核心思想
要找出从不订购的客户，我们需要：
1. 找出所有下过订单的客户 ID
2. 在 Customers 表中找出不在这些 ID 中的客户

这正是 NOT IN 子查询的典型应用场景。

#### 🛠️ 实现步骤
1. 使用子查询 `SELECT customerId FROM Orders` 获取所有下过订单的客户 ID
2. 使用 `NOT IN` 找出不在这些 ID 中的客户
3. 从 Customers 表中选择这些客户的姓名
4. 使用 `AS` 将结果列重命名为 Customers

#### 🧩 示例分析
以示例数据为例，让我们看看查询是如何工作的：

1. 首先，获取所有下过订单的客户 ID：
```
SELECT customerId FROM Orders
结果：
customerId
----------
3
1
```

2. 在 Customers 表中查找不在这些 ID 中的客户：
```
Customers 表：
id | name
---+-------
1  | Joe    ← 在 Orders 中
2  | Henry  ← 不在 Orders 中
3  | Sam    ← 在 Orders 中
4  | Max    ← 不在 Orders 中
```

3. 最终输出（只包含不在 Orders 中的客户姓名）：
```
Customers
---------
Henry
Max
```

---

## 代码实现

完整的可运行代码：[L0183_CustomersWhoNeverOrder.java](../src/main/java/L0183_CustomersWhoNeverOrder.java)

```java
public String getSQL() {
    return "SELECT name AS Customers " +
           "FROM Customers " +
           "WHERE id NOT IN (SELECT customerId FROM Orders)";
}
```

---

## 复杂度分析

- **时间复杂度**：O(n)，其中 n 是 Customers 表中的记录数。对于每个客户，我们都需要检查其 ID 是否在 Orders 表中。
- **空间复杂度**：O(m)，其中 m 是 Orders 表中的记录数。需要存储所有下过订单的客户 ID。

---

## LeetCode 题解

本题解是 LeetCode 系列题解的一部分。该系列题解致力于帮助程序员更好地理解和掌握算法思维，内容包含详细的解题思路分析、图文并茂的示例讲解和完整的代码实现。

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode 最全题解](https://github.com/LjyYano/LeetCode)：持续更新中，欢迎 Star ⭐️ 关注，一起探讨算法之美。 
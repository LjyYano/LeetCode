---
title: è¡Œç¨‹å’Œç”¨æˆ·
date: 2025-02-10
---

## é¢˜ç›®æè¿°

**ğŸ”— é¢˜ç›®**ï¼š[è¡Œç¨‹å’Œç”¨æˆ·](https://leetcode.cn/problems/trips-and-users/)  
**ğŸ·ï¸ æ ‡ç­¾**ï¼š`æ•°æ®åº“`  
**ğŸ”´ éš¾åº¦**ï¼š`å›°éš¾`  

è¡¨ï¼šTrips

```
+-------------+----------+
| Column Name | Type     |
+-------------+----------+
| id          | int      |
| client_id   | int      |
| driver_id   | int      |
| city_id     | int      |
| status      | enum     |
| request_at  | date     |     
+-------------+----------+
```

id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
è¿™å¼ è¡¨ä¸­å­˜æ‰€æœ‰å‡ºç§Ÿè½¦çš„è¡Œç¨‹ä¿¡æ¯ã€‚æ¯æ®µè¡Œç¨‹æœ‰å”¯ä¸€ id ï¼Œå…¶ä¸­ client_id å’Œ driver_id æ˜¯ Users è¡¨ä¸­ users_id çš„å¤–é”®ã€‚
status æ˜¯ä¸€ä¸ªè¡¨ç¤ºè¡Œç¨‹çŠ¶æ€çš„æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º('completed', 'cancelled_by_driver', 'cancelled_by_client') ã€‚

è¡¨ï¼šUsers

```
+-------------+----------+
| Column Name | Type     |
+-------------+----------+
| users_id    | int      |
| banned      | enum     |
| role        | enum     |
+-------------+----------+
```

users_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
è¿™å¼ è¡¨ä¸­å­˜æ‰€æœ‰ç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ users_id ï¼Œrole æ˜¯ä¸€ä¸ªè¡¨ç¤ºç”¨æˆ·èº«ä»½çš„æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º ('client', 'driver', 'partner') ã€‚
banned æ˜¯ä¸€ä¸ªè¡¨ç¤ºç”¨æˆ·æ˜¯å¦è¢«ç¦æ­¢çš„æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º ('Yes', 'No') ã€‚

å–æ¶ˆç‡ çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š(è¢«å¸æœºæˆ–ä¹˜å®¢å–æ¶ˆçš„éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ•°é‡) / (éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ€»æ•°)ã€‚

å†™ä¸€æ®µ SQL è¯­å¥æŸ¥å‡º "2013-10-01" è‡³ "2013-10-03" æœŸé—´éç¦æ­¢ç”¨æˆ·ï¼ˆä¹˜å®¢å’Œå¸æœºéƒ½å¿…é¡»æœªè¢«ç¦æ­¢ï¼‰çš„å–æ¶ˆç‡ã€‚
è¿”å›ç»“æœè¡¨ä¸­çš„æ•°æ®å¯ä»¥æŒ‰ä»»æ„é¡ºåºç»„ç»‡ã€‚

æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š

Trips è¡¨ï¼š
```
+----+-----------+-----------+---------+---------------------+------------+
| id | client_id | driver_id | city_id | status             | request_at |
+----+-----------+-----------+---------+---------------------+------------+
| 1  | 1         | 10        | 1       | completed          | 2013-10-01 |
| 2  | 2         | 11        | 1       | cancelled_by_driver| 2013-10-01 |
| 3  | 3         | 12        | 6       | completed          | 2013-10-01 |
| 4  | 4         | 13        | 6       | cancelled_by_client| 2013-10-01 |
| 5  | 1         | 10        | 1       | completed          | 2013-10-02 |
| 6  | 2         | 11        | 6       | completed          | 2013-10-02 |
| 7  | 3         | 12        | 6       | completed          | 2013-10-02 |
| 8  | 2         | 12        | 12      | completed          | 2013-10-03 |
| 9  | 3         | 10        | 12      | completed          | 2013-10-03 |
| 10 | 4         | 13        | 12      | cancelled_by_driver| 2013-10-03 |
+----+-----------+-----------+---------+---------------------+------------+
```

Users è¡¨ï¼š
```
+----------+--------+--------+
| users_id | banned | role   |
+----------+--------+--------+
| 1        | No     | client |
| 2        | Yes    | client |
| 3        | No     | client |
| 4        | No     | client |
| 10       | No     | driver |
| 11       | No     | driver |
| 12       | No     | driver |
| 13       | No     | driver |
+----------+--------+--------+
```

Result è¡¨ï¼š
```
+------------+-------------------+
| Day        | Cancellation Rate |
+------------+-------------------+
| 2013-10-01 | 0.33             |
| 2013-10-02 | 0.00             |
| 2013-10-03 | 0.50             |
+------------+-------------------+
```

2013-10-01ï¼š
- 4 ä¸ªè¯·æ±‚ä¸­æœ‰ 2 ä¸ªæ¥è‡ªæœªè¢«ç¦æ­¢çš„ç”¨æˆ·ï¼ˆID ä¸º 1ï¼Œ3ï¼Œ4 çš„ç”¨æˆ·ï¼‰
- 2 ä¸ªæœªè¢«ç¦æ­¢çš„ç”¨æˆ·çš„è¯·æ±‚ä¸­æœ‰ 1 ä¸ªå–æ¶ˆ
- å› æ­¤å–æ¶ˆç‡ä¸º (1/2)=0.33

2013-10-02ï¼š
- 3 ä¸ªè¯·æ±‚ä¸­æœ‰ 3 ä¸ªæ¥è‡ªæœªè¢«ç¦æ­¢çš„ç”¨æˆ·ï¼ˆID ä¸º 1ï¼Œ3 çš„ç”¨æˆ·ï¼‰
- 3 ä¸ªæœªè¢«ç¦æ­¢çš„ç”¨æˆ·çš„è¯·æ±‚ä¸­æœ‰ 0 ä¸ªå–æ¶ˆ
- å› æ­¤å–æ¶ˆç‡ä¸º (0/3)=0.00

2013-10-03ï¼š
- 3 ä¸ªè¯·æ±‚ä¸­æœ‰ 2 ä¸ªæ¥è‡ªæœªè¢«ç¦æ­¢çš„ç”¨æˆ·ï¼ˆID ä¸º 3ï¼Œ4 çš„ç”¨æˆ·ï¼‰
- 2 ä¸ªæœªè¢«ç¦æ­¢çš„ç”¨æˆ·çš„è¯·æ±‚ä¸­æœ‰ 1 ä¸ªå–æ¶ˆ
- å› æ­¤å–æ¶ˆç‡ä¸º (1/2)=0.50

---

## è§£é¢˜æ€è·¯
### SQL æŸ¥è¯¢åˆ†æ

#### ğŸ“ æ ¸å¿ƒæ€æƒ³
1. é¦–å…ˆéœ€è¦è¿‡æ»¤å‡ºæœªè¢«ç¦æ­¢çš„ç”¨æˆ·ï¼ˆåŒ…æ‹¬ä¹˜å®¢å’Œå¸æœºï¼‰
2. ç„¶åç»Ÿè®¡è¿™äº›ç”¨æˆ·åœ¨æŒ‡å®šæ—¥æœŸèŒƒå›´å†…çš„è¡Œç¨‹å–æ¶ˆç‡
3. æŒ‰æ—¥æœŸåˆ†ç»„å±•ç¤ºç»“æœ

#### ğŸ› ï¸ å®ç°æ­¥éª¤
1. ä½¿ç”¨ JOIN è¿æ¥ Trips å’Œ Users è¡¨ï¼š
   - å°† Trips è¡¨ä¸ Users è¡¨è¿æ¥ä¸¤æ¬¡ï¼Œä¸€æ¬¡ç”¨äºä¹˜å®¢ï¼Œä¸€æ¬¡ç”¨äºå¸æœº
   - ä½¿ç”¨ banned = 'No' æ¡ä»¶è¿‡æ»¤å‡ºæœªè¢«ç¦æ­¢çš„ç”¨æˆ·
2. ä½¿ç”¨ WHERE å­å¥é™å®šæ—¥æœŸèŒƒå›´
3. ä½¿ç”¨ GROUP BY æŒ‰æ—¥æœŸåˆ†ç»„
4. ä½¿ç”¨ CASE è¯­å¥è®¡ç®—å–æ¶ˆç‡ï¼š
   - åˆ†å­ï¼šstatus ä¸ä¸º 'completed' çš„è®°å½•æ•°
   - åˆ†æ¯ï¼šæ€»è®°å½•æ•°
5. ä½¿ç”¨ ROUND å‡½æ•°ä¿ç•™ä¸¤ä½å°æ•°

#### ğŸ§© ç¤ºä¾‹åˆ†æ
ä»¥ 2013-10-01 è¿™ä¸€å¤©ä¸ºä¾‹ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ SQL æ˜¯å¦‚ä½•å¤„ç†æ•°æ®çš„ï¼š

1. é¦–å…ˆè¿‡æ»¤ç”¨æˆ·ï¼š
   ```
   åŸå§‹æ•°æ®ï¼š
   ID 1ï¼ˆæœªç¦æ­¢ï¼‰- completed
   ID 2ï¼ˆå·²ç¦æ­¢ï¼‰- cancelled_by_driverï¼ˆè¢«è¿‡æ»¤ï¼‰
   ID 3ï¼ˆæœªç¦æ­¢ï¼‰- completed
   ID 4ï¼ˆæœªç¦æ­¢ï¼‰- cancelled_by_client
   ```

2. è®¡ç®—å–æ¶ˆç‡ï¼š
   ```
   æœ‰æ•ˆè®¢å•æ•°ï¼š3ï¼ˆæ¥è‡ª ID 1ã€3ã€4ï¼‰
   å–æ¶ˆè®¢å•æ•°ï¼š1ï¼ˆæ¥è‡ª ID 4ï¼‰
   å–æ¶ˆç‡ï¼š1/3 â‰ˆ 0.33
   ```

---

## ä»£ç å®ç°

å®Œæ•´çš„å¯è¿è¡Œä»£ç ï¼š[L0262_TripsAndUsers.java](../src/main/java/L0262_TripsAndUsers.java)

```sql
SELECT 
    t.request_at AS Day,
    ROUND(
        SUM(
            CASE 
                WHEN t.status != 'completed' THEN 1 
                ELSE 0 
            END
        ) / COUNT(*),
        2
    ) AS 'Cancellation Rate'
FROM Trips t
JOIN Users u1 ON t.client_id = u1.users_id AND u1.banned = 'No'
JOIN Users u2 ON t.driver_id = u2.users_id AND u2.banned = 'No'
WHERE t.request_at BETWEEN '2013-10-01' AND '2013-10-03'
GROUP BY t.request_at
```

---

## å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯ Trips è¡¨ä¸­çš„è®°å½•æ•°ã€‚éœ€è¦æ‰«æ Trips è¡¨ä¸€æ¬¡ï¼Œå¹¶ä¸ Users è¡¨è¿›è¡Œè¿æ¥ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼šO(m)ï¼Œå…¶ä¸­ m æ˜¯ç»“æœé›†çš„å¤§å°ï¼Œå³ä¸åŒçš„æ—¥æœŸæ•°é‡ã€‚éœ€è¦å­˜å‚¨æŒ‰æ—¥æœŸåˆ†ç»„åçš„ç»“æœã€‚

---

## LeetCode é¢˜è§£
     
æœ¬é¢˜è§£æ˜¯ LeetCode ç³»åˆ—é¢˜è§£çš„ä¸€éƒ¨åˆ†ã€‚è¯¥ç³»åˆ—é¢˜è§£è‡´åŠ›äºå¸®åŠ©ç¨‹åºå‘˜æ›´å¥½åœ°ç†è§£å’ŒæŒæ¡ç®—æ³•æ€ç»´ï¼Œå†…å®¹åŒ…å«è¯¦ç»†çš„è§£é¢˜æ€è·¯åˆ†æã€å›¾æ–‡å¹¶èŒ‚çš„ç¤ºä¾‹è®²è§£å’Œå®Œæ•´çš„ä»£ç å®ç°ã€‚
     
<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode æœ€å…¨é¢˜è§£](https://github.com/LjyYano/LeetCode)ï¼šæŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿ Star â­ï¸ å…³æ³¨ï¼Œä¸€èµ·æ¢è®¨ç®—æ³•ä¹‹ç¾ã€‚ 
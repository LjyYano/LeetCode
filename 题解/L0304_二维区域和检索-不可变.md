---
title: äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - ä¸å¯å˜
date: 2024-03-27
---

## é¢˜ç›®æè¿°

**ğŸ”— é¢˜ç›®**ï¼š[äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - ä¸å¯å˜](https://leetcode.cn/problems/range-sum-query-2d-immutable/)  
**ğŸ·ï¸ æ ‡ç­¾**ï¼š`æ•°ç»„` `è®¾è®¡` `çŸ©é˜µ` `å‰ç¼€å’Œ`  
**ğŸŸ¡ éš¾åº¦**ï¼š`ä¸­ç­‰`  

ç»™å®šä¸€ä¸ªäºŒç»´çŸ©é˜µ matrixï¼Œä»¥ä¸‹ç±»å‹çš„å¤šä¸ªè¯·æ±‚ï¼š
- è®¡ç®—å…¶å­çŸ©å½¢èŒƒå›´å†…å…ƒç´ çš„æ€»å’Œï¼Œè¯¥å­çŸ©é˜µçš„ å·¦ä¸Šè§’ ä¸º (row1, col1) ï¼Œå³ä¸‹è§’ ä¸º (row2, col2) ã€‚

å®ç° NumMatrix ç±»ï¼š
- NumMatrix(int[][] matrix) ç»™å®šæ•´æ•°çŸ©é˜µ matrix è¿›è¡Œåˆå§‹åŒ–
- int sumRegion(int row1, int col1, int row2, int col2) è¿”å› å·¦ä¸Šè§’ (row1, col1) ã€å³ä¸‹è§’ (row2, col2) æ‰€æè¿°çš„å­çŸ©é˜µçš„å…ƒç´  æ€»å’Œ ã€‚

**ç¤ºä¾‹ï¼š**
```
è¾“å…¥: 
["NumMatrix","sumRegion","sumRegion","sumRegion"]
[[[[3,0,1,4,2],[5,6,3,2,1],[1,2,0,1,5],[4,1,0,1,7],[1,0,3,0,5]]],[2,1,4,3],[1,1,2,2],[1,2,2,4]]
è¾“å‡º: 
[null, 8, 11, 12]

è§£é‡Š:
NumMatrix numMatrix = new NumMatrix([[3,0,1,4,2],[5,6,3,2,1],[1,2,0,1,5],[4,1,0,1,7],[1,0,3,0,5]]);
numMatrix.sumRegion(2, 1, 4, 3); // return 8 (çº¢è‰²çŸ©å½¢æ¡†çš„å…ƒç´ æ€»å’Œ)
numMatrix.sumRegion(1, 1, 2, 2); // return 11 (ç»¿è‰²çŸ©å½¢æ¡†çš„å…ƒç´ æ€»å’Œ)
numMatrix.sumRegion(1, 2, 2, 4); // return 12 (è“è‰²çŸ©å½¢æ¡†çš„å…ƒç´ æ€»å’Œ)
```

**æç¤ºï¼š**
- m == matrix.length
- n == matrix[i].length
- 1 <= m, n <= 200
- -10âµ <= matrix[i][j] <= 10âµ
- 0 <= row1 <= row2 < m
- 0 <= col1 <= col2 < n
- æœ€å¤šè°ƒç”¨ 10â´ æ¬¡ sumRegion æ–¹æ³•

---

## è§£é¢˜æ€è·¯

### äºŒç»´å‰ç¼€å’Œ

#### ğŸ“ æ ¸å¿ƒæ€æƒ³
è¿™é“é¢˜æ˜¯ä¸€ç»´å‰ç¼€å’Œçš„æ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨äºŒç»´å‰ç¼€å’Œæ¥è§£å†³ã€‚äºŒç»´å‰ç¼€å’Œæ•°ç»„ prefixSum[i][j] è¡¨ç¤ºä»çŸ©é˜µå·¦ä¸Šè§’ (0,0) åˆ°ä½ç½® (i-1,j-1) çš„å­çŸ©é˜µå…ƒç´ æ€»å’Œã€‚é€šè¿‡äºŒç»´å‰ç¼€å’Œï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ O(1) æ—¶é—´å†…è®¡ç®—å‡ºä»»æ„å­çŸ©é˜µçš„å…ƒç´ å’Œã€‚

#### ğŸ› ï¸ å®ç°æ­¥éª¤
1. åˆå§‹åŒ–ï¼š
   - åˆ›å»ºä¸€ä¸ª (m+1) Ã— (n+1) çš„å‰ç¼€å’Œæ•°ç»„ï¼Œå¤šå‡ºçš„ä¸€è¡Œä¸€åˆ—ç”¨äºå¤„ç†è¾¹ç•Œæƒ…å†µ
   - è®¡ç®—æ¯ä¸ªä½ç½®çš„å‰ç¼€å’Œï¼šprefixSum[i][j] = prefixSum[i-1][j] + prefixSum[i][j-1] - prefixSum[i-1][j-1] + matrix[i-1][j-1]

2. æŸ¥è¯¢å­çŸ©é˜µå’Œï¼š
   - ä½¿ç”¨å®¹æ–¥åŸç†è®¡ç®—å­çŸ©é˜µå…ƒç´ å’Œ
   - sumRegion(row1, col1, row2, col2) = prefixSum[row2+1][col2+1] - prefixSum[row2+1][col1] - prefixSum[row1][col2+1] + prefixSum[row1][col1]

#### ğŸ§© ç¤ºä¾‹åˆ†æ
ä»¥ç¤ºä¾‹çŸ©é˜µä¸ºä¾‹ï¼š
```
3 0 1 4 2
5 6 3 2 1
1 2 0 1 5
4 1 0 1 7
1 0 3 0 5
```

1. æ„å»ºå‰ç¼€å’Œæ•°ç»„ï¼ˆä¸ºäº†æ¸…æ™°èµ·è§ï¼Œåªå±•ç¤ºéƒ¨åˆ†æ•°å€¼ï¼‰ï¼š
```
0  0  0   0   0   0
0  3  3   4   8  10
0  8  14  18  24  27
0  9  17  21  28  36
0  13 22  26  34  49
0  14 23  30  38  58
```

2. è®¡ç®— sumRegion(2, 1, 4, 3) çš„è¿‡ç¨‹ï¼š
```
ç›®æ ‡åŒºåŸŸï¼š
* * * *
* 2 0 1
* 1 0 1
* 0 3 0

ä½¿ç”¨å‰ç¼€å’Œè®¡ç®—ï¼š
prefixSum[5][4] = 38
prefixSum[5][1] = 14
prefixSum[2][4] = 28
prefixSum[2][1] = 12

ç»“æœ = 38 - 14 - 28 + 12 = 8
```

---

## ä»£ç å®ç°

å®Œæ•´çš„å¯è¿è¡Œä»£ç ï¼š[L0304_RangeSumQuery2DImmutable.java](../src/main/java/L0304_RangeSumQuery2DImmutable.java)

```java
public class L0304_RangeSumQuery2DImmutable {
    
    private final int[][] prefixSum;
    
    public L0304_RangeSumQuery2DImmutable(int[][] matrix) {
        if (matrix == null || matrix.length == 0 || matrix[0].length == 0) {
            prefixSum = new int[0][0];
            return;
        }
        
        int m = matrix.length;
        int n = matrix[0].length;
        // åˆ›å»ºå‰ç¼€å’Œæ•°ç»„ï¼Œå¤§å°ä¸º (m+1) Ã— (n+1)
        // prefixSum[i][j] è¡¨ç¤ºä» (0,0) åˆ° (i-1,j-1) çš„å­çŸ©é˜µå…ƒç´ å’Œ
        prefixSum = new int[m + 1][n + 1];
        
        // è®¡ç®—äºŒç»´å‰ç¼€å’Œ
        for (int i = 1; i <= m; i++) {
            for (int j = 1; j <= n; j++) {
                prefixSum[i][j] = prefixSum[i - 1][j] + prefixSum[i][j - 1] 
                        - prefixSum[i - 1][j - 1] + matrix[i - 1][j - 1];
            }
        }
    }
    
    public int sumRegion(int row1, int col1, int row2, int col2) {
        // ä½¿ç”¨å®¹æ–¥åŸç†è®¡ç®—å­çŸ©é˜µçš„å’Œ
        return prefixSum[row2 + 1][col2 + 1] - prefixSum[row2 + 1][col1] 
                - prefixSum[row1][col2 + 1] + prefixSum[row1][col1];
    }
}
```

---

## å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š
  - æ„é€ å‡½æ•°ï¼šO(m Ã— n)ï¼Œå…¶ä¸­ m å’Œ n åˆ†åˆ«æ˜¯çŸ©é˜µçš„è¡Œæ•°å’Œåˆ—æ•°ï¼Œéœ€è¦éå†æ•´ä¸ªçŸ©é˜µæ¥è®¡ç®—å‰ç¼€å’Œ
  - sumRegion æ–¹æ³•ï¼šO(1)ï¼Œåªéœ€è¦è¿›è¡Œå››æ¬¡æ•°ç»„è®¿é—®å’Œä¸‰æ¬¡åŠ å‡è¿ç®—

- **ç©ºé—´å¤æ‚åº¦**ï¼šO(m Ã— n)
  - éœ€è¦ä¸€ä¸ªå¤§å°ä¸º (m+1) Ã— (n+1) çš„äºŒç»´æ•°ç»„æ¥å­˜å‚¨å‰ç¼€å’Œ

---

## LeetCode é¢˜è§£

æœ¬é¢˜è§£æ˜¯ LeetCode ç³»åˆ—é¢˜è§£çš„ä¸€éƒ¨åˆ†ã€‚è¯¥ç³»åˆ—é¢˜è§£è‡´åŠ›äºå¸®åŠ©ç¨‹åºå‘˜æ›´å¥½åœ°ç†è§£å’ŒæŒæ¡ç®—æ³•æ€ç»´ï¼Œå†…å®¹åŒ…å«è¯¦ç»†çš„è§£é¢˜æ€è·¯åˆ†æã€å›¾æ–‡å¹¶èŒ‚çš„ç¤ºä¾‹è®²è§£å’Œå®Œæ•´çš„ä»£ç å®ç°ã€‚

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode æœ€å…¨é¢˜è§£](https://github.com/LjyYano/LeetCode)ï¼šæŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿ Star â­ï¸ å…³æ³¨ï¼Œä¸€èµ·æ¢è®¨ç®—æ³•ä¹‹ç¾ã€‚ 
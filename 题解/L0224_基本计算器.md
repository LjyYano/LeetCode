---
title: 基本计算器
date: 2024-03-25
---

## 题目描述

**🔗 题目**：[基本计算器](https://leetcode.cn/problems/basic-calculator/)  
**🏷️ 标签**：`栈` `递归` `数学` `字符串`  
**🔴 难度**：`困难`  

给你一个字符串表达式 s ，请你实现一个基本计算器来计算并返回它的值。
注意:不允许使用任何将字符串作为数学表达式计算的内置函数，比如 eval() 。

**示例 1：**
```
输入：s = "1 + 1"
输出：2
```

**示例 2：**
```
输入：s = " 2-1 + 2 "
输出：3
```

**示例 3：**
```
输入：s = "(1+(4+5+2)-3)+(6+8)"
输出：23
```

**提示：**
- 1 <= s.length <= 3 * 10^5
- s 由数字、'+'、'-'、'('、')'、和 ' ' 组成
- s 表示一个有效的表达式
- '+' 不能用作一元运算(例如， "+1" 和 "+(2 + 3)" 无效)
- '-' 可以用作一元运算(即 "-1" 和 "-(2 + 3)" 是有效的)
- 输入中不存在两个连续的操作符
- 每个数字和运行的计算将适合于一个有符号的 32 位整数

---

## 解题思路

### 栈实现

#### 📝 核心思想
使用栈来处理括号表达式，通过维护当前结果、当前数字和当前符号来计算表达式的值。遇到括号时，将当前结果和符号压入栈中，处理完括号内的表达式后再与栈中的值进行计算。

#### 🛠️ 实现步骤
1. 初始化变量：
   - result：当前计算结果
   - number：当前正在处理的数字
   - sign：当前符号（1 表示正，-1 表示负）
   - stack：用于存储括号外的结果和符号

2. 遍历字符串中的每个字符：
   - 如果是数字：累加到 number 中
   - 如果是 '+'：计算当前结果，重置 number 和 sign
   - 如果是 '-'：计算当前结果，重置 number 和 sign
   - 如果是 '('：将当前结果和符号压入栈
   - 如果是 ')'：计算括号内的结果，与栈中的值进行计算

3. 最后处理可能剩余的数字

#### 🧩 示例分析
以 `s = "(1+(4+5+2)-3)+(6+8)"` 为例：

| 步骤 | 字符 | number | sign | result | stack | 说明 |
|-----|------|--------|------|--------|-------|------|
| 1 | '(' | 0 | 1 | 0 | [0,1] | 将当前结果和符号压栈 |
| 2 | '1' | 1 | 1 | 0 | [0,1] | 读取数字 |
| 3 | '+' | 0 | 1 | 1 | [0,1] | 计算结果，重置 number |
| 4 | '(' | 0 | 1 | 1 | [0,1,1,1] | 将当前结果和符号压栈 |
| 5 | '4' | 4 | 1 | 0 | [0,1,1,1] | 读取数字 |
| 6 | '+' | 0 | 1 | 4 | [0,1,1,1] | 计算结果，重置 number |
| 7 | '5' | 5 | 1 | 4 | [0,1,1,1] | 读取数字 |
| 8 | '+' | 0 | 1 | 9 | [0,1,1,1] | 计算结果，重置 number |
| 9 | '2' | 2 | 1 | 9 | [0,1,1,1] | 读取数字 |
| 10 | ')' | 0 | 1 | 11 | [0,1] | 计算括号内结果：11 |
| 11 | '-' | 0 | -1 | 12 | [0,1] | 计算结果，设置负号 |
| 12 | '3' | 3 | -1 | 12 | [0,1] | 读取数字 |
| 13 | ')' | 0 | 1 | 9 | [] | 计算括号内结果：12-3=9 |
| 14 | '+' | 0 | 1 | 9 | [] | 计算结果，重置 number |
| 15 | '(' | 0 | 1 | 9 | [9,1] | 将当前结果和符号压栈 |
| 16 | '6' | 6 | 1 | 0 | [9,1] | 读取数字 |
| 17 | '+' | 0 | 1 | 6 | [9,1] | 计算结果，重置 number |
| 18 | '8' | 8 | 1 | 6 | [9,1] | 读取数字 |
| 19 | ')' | 0 | 1 | 23 | [] | 计算最终结果：9+14=23 |

---

## 代码实现

完整的可运行代码：[L0224_BasicCalculator.java](../src/main/java/L0224_BasicCalculator.java)

```java
public int calculate(String s) {
    Stack<Integer> stack = new Stack<>();
    int result = 0;  // 当前结果
    int number = 0;  // 当前数字
    int sign = 1;    // 当前符号：1表示正，-1表示负
    
    for (int i = 0; i < s.length(); i++) {
        char c = s.charAt(i);
        
        if (Character.isDigit(c)) {
            // 如果是数字，累加到number
            number = number * 10 + (c - '0');
        } else if (c == '+') {
            // 计算前面的结果
            result += sign * number;
            // 重置number和sign
            number = 0;
            sign = 1;
        } else if (c == '-') {
            // 计算前面的结果
            result += sign * number;
            // 重置number和sign
            number = 0;
            sign = -1;
        } else if (c == '(') {
            // 遇到左括号，将当前结果和符号压入栈
            stack.push(result);
            stack.push(sign);
            // 重置result和sign
            result = 0;
            sign = 1;
        } else if (c == ')') {
            // 计算括号内的最后一个数字
            result += sign * number;
            // 重置number
            number = 0;
            // 从栈中取出符号和结果
            result *= stack.pop();    // 取出符号
            result += stack.pop();    // 取出之前的结果
        }
    }
    
    // 处理最后一个数字
    if (number != 0) {
        result += sign * number;
    }
    
    return result;
}
```

---

## 复杂度分析

- **时间复杂度**：O(n)，其中 n 是字符串的长度。我们需要遍历字符串一次。

- **空间复杂度**：O(n)，在最坏情况下（括号嵌套层数最多），栈的大小可能达到 O(n)。

---

## LeetCode 题解

本题解是 LeetCode 系列题解的一部分。该系列题解致力于帮助程序员更好地理解和掌握算法思维，内容包含详细的解题思路分析、图文并茂的示例讲解和完整的代码实现。

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode 最全题解](https://github.com/LjyYano/LeetCode)：持续更新中，欢迎 Star ⭐️ 关注，一起探讨算法之美。 
---
title: O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´  - å…è®¸é‡å¤
date: 2024-03-27
---

## é¢˜ç›®æè¿°

**ğŸ”— é¢˜ç›®**ï¼š[O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´  - å…è®¸é‡å¤](https://leetcode.cn/problems/insert-delete-getrandom-o1-duplicates-allowed/)  
**ğŸ·ï¸ æ ‡ç­¾**ï¼š`è®¾è®¡` `æ•°ç»„` `å“ˆå¸Œè¡¨` `æ•°å­¦` `éšæœºåŒ–`  
**ğŸ”´ éš¾åº¦**ï¼š`å›°éš¾`  

RandomizedCollection æ˜¯ä¸€ä¸ªåŒ…å«æ•°å­—é›†åˆ(å¯èƒ½åŒ…å«é‡å¤é¡¹)çš„æ•°æ®ç»“æ„ã€‚å®ƒåº”è¯¥æ”¯æŒæ’å…¥å’Œåˆ é™¤ç‰¹å®šå…ƒç´ ï¼Œä»¥åŠåˆ é™¤éšæœºå…ƒç´ ã€‚

å®ç° RandomizedCollection ç±»:
- RandomizedCollection() åˆå§‹åŒ–ç©ºçš„ RandomizedCollection å¯¹è±¡
- bool insert(int val) å°†ä¸€ä¸ª val é¡¹æ’å…¥åˆ°é›†åˆä¸­ï¼Œå³ä½¿è¯¥é¡¹å·²å­˜åœ¨ã€‚å¦‚æœè¯¥é¡¹ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› true ï¼Œå¦åˆ™è¿”å› false ã€‚
- bool remove(int val) ä»é›†åˆä¸­åˆ é™¤ä¸€ä¸ª val é¡¹ï¼Œå¦‚æœè¯¥é¡¹å­˜åœ¨ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚å¦‚æœè¯¥é¡¹æœ‰å¤šä¸ªï¼Œåˆ™åˆ é™¤å…¶ä¸­ä»»æ„ä¸€ä¸ªã€‚
- int getRandom() ä»å½“å‰çš„å¤šä¸ªå…ƒç´ é›†åˆä¸­è¿”å›ä¸€ä¸ªéšæœºå…ƒç´ ã€‚æ¯ä¸ªå…ƒç´ è¢«è¿”å›çš„æ¦‚ç‡ä¸é›†åˆä¸­åŒ…å«è¯¥å…ƒç´ çš„æ•°é‡å‘ˆçº¿æ€§ç›¸å…³ã€‚

ä½ å¿…é¡»å®ç°ç±»çš„æ‰€æœ‰å‡½æ•°ï¼Œå¹¶æ»¡è¶³æ¯ä¸ªå‡½æ•°çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(1) ã€‚

ç¤ºä¾‹ï¼š
```
è¾“å…¥
["RandomizedCollection", "insert", "insert", "insert", "getRandom", "remove", "getRandom"]
[[], [1], [1], [2], [], [1], []]
è¾“å‡º
[null, true, false, true, 2, true, 1]

è§£é‡Š
RandomizedCollection collection = new RandomizedCollection();// åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„é›†åˆ
collection.insert(1);   // è¿”å› trueï¼Œå› ä¸ºé›†åˆä¸åŒ…å« 1
                       // å°† 1 æ’å…¥åˆ°é›†åˆä¸­
collection.insert(1);   // è¿”å› falseï¼Œå› ä¸ºé›†åˆåŒ…å« 1
                       // å°†å¦ä¸€ä¸ª 1 æ’å…¥åˆ°é›†åˆä¸­
                       // é›†åˆç°åœ¨åŒ…å« [1,1]
collection.insert(2);   // è¿”å› trueï¼Œå› ä¸ºé›†åˆä¸åŒ…å« 2
                       // å°† 2 æ’å…¥åˆ°é›†åˆä¸­
                       // é›†åˆç°åœ¨åŒ…å« [1,1,2]
collection.getRandom(); // getRandom åº”å½“:
                       // æœ‰ 2/3 çš„æ¦‚ç‡è¿”å› 1
                       // æœ‰ 1/3 çš„æ¦‚ç‡è¿”å› 2
collection.remove(1);   // è¿”å› trueï¼Œå› ä¸ºé›†åˆåŒ…å« 1
                       // ä»é›†åˆä¸­ç§»é™¤ 1
                       // é›†åˆç°åœ¨åŒ…å« [1,2]
collection.getRandom(); // getRandom åº”å½“:
                       // æœ‰ 1/2 çš„æ¦‚ç‡è¿”å› 1
                       // æœ‰ 1/2 çš„æ¦‚ç‡è¿”å› 2
```

æç¤ºï¼š
* -2Â³Â¹ <= val <= 2Â³Â¹ - 1
* insert, remove å’Œ getRandom æœ€å¤š æ€»å…± è¢«è°ƒç”¨ 2 * 10âµ æ¬¡
* å½“è°ƒç”¨ getRandom æ—¶ï¼Œæ•°æ®ç»“æ„ä¸­ è‡³å°‘æœ‰ä¸€ä¸ª å…ƒç´ 

---

## è§£é¢˜æ€è·¯

### æ•°æ®ç»“æ„è®¾è®¡

#### ğŸ“ æ ¸å¿ƒæ€æƒ³
è¦å®ç°æ‰€æœ‰æ“ä½œçš„ O(1) æ—¶é—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬éœ€è¦å·§å¦™åœ°ç»„åˆä¸¤ä¸ªæ•°æ®ç»“æ„ï¼š
1. ArrayListï¼šç”¨äºå­˜å‚¨æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…æ‹¬é‡å¤çš„ï¼‰ï¼Œæ”¯æŒ O(1) çš„éšæœºè®¿é—®
2. HashMap<Integer, Set<Integer>>ï¼šç”¨äºå­˜å‚¨æ¯ä¸ªå€¼å¯¹åº”çš„æ‰€æœ‰ç´¢å¼•ï¼Œæ”¯æŒ O(1) çš„æŸ¥æ‰¾å’Œåˆ é™¤

#### ğŸ› ï¸ å®ç°æ­¥éª¤
1. **åˆå§‹åŒ–**ï¼š
   - åˆ›å»º ArrayList å­˜å‚¨å…ƒç´ 
   - åˆ›å»º HashMap å­˜å‚¨ç´¢å¼•
   - åˆå§‹åŒ–éšæœºæ•°ç”Ÿæˆå™¨

2. **æ’å…¥æ“ä½œ**ï¼š
   - å°†å…ƒç´ æ·»åŠ åˆ° ArrayList æœ«å°¾
   - åœ¨ HashMap ä¸­æ·»åŠ æˆ–æ›´æ–°è¯¥å…ƒç´ çš„ç´¢å¼•é›†åˆ
   - è¿”å›è¯¥å…ƒç´ æ˜¯å¦ä¸ºæ–°å…ƒç´ 

3. **åˆ é™¤æ“ä½œ**ï¼š
   - ä» HashMap ä¸­è·å–è¦åˆ é™¤å…ƒç´ çš„ä¸€ä¸ªç´¢å¼•
   - å°†æœ€åä¸€ä¸ªå…ƒç´ ç§»åŠ¨åˆ°è¦åˆ é™¤çš„ä½ç½®
   - æ›´æ–° HashMap ä¸­çš„ç´¢å¼•ä¿¡æ¯
   - åˆ é™¤ ArrayList çš„æœ€åä¸€ä¸ªå…ƒç´ 

4. **éšæœºè·å–**ï¼š
   - ç›´æ¥ä» ArrayList ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ 

#### ğŸ§© ç¤ºä¾‹åˆ†æ
ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…·ä½“çš„æ“ä½œåºåˆ—ç¤ºä¾‹ï¼š

1. åˆå§‹çŠ¶æ€ï¼š
```
ArrayList: []
HashMap: {}
```

2. insert(1)ï¼š
```
ArrayList: [1]
HashMap: {1: {0}}
è¿”å›ï¼štrueï¼ˆæ–°å…ƒç´ ï¼‰
```

3. insert(1)ï¼š
```
ArrayList: [1, 1]
HashMap: {1: {0, 1}}
è¿”å›ï¼šfalseï¼ˆå·²å­˜åœ¨å…ƒç´ ï¼‰
```

4. insert(2)ï¼š
```
ArrayList: [1, 1, 2]
HashMap: {1: {0, 1}, 2: {2}}
è¿”å›ï¼štrueï¼ˆæ–°å…ƒç´ ï¼‰
```

5. remove(1)ï¼š
```
ArrayList: [1, 2]
HashMap: {1: {0}, 2: {1}}
è¿”å›ï¼štrueï¼ˆæˆåŠŸåˆ é™¤ï¼‰
```

---

## ä»£ç å®ç°

å®Œæ•´çš„å¯è¿è¡Œä»£ç ï¼š[L0381_RandomizedCollectionWithDuplicates.java](../src/main/java/L0381_RandomizedCollectionWithDuplicates.java)

```java
public class L0381_RandomizedCollectionWithDuplicates {
    private List<Integer> nums;
    private Map<Integer, Set<Integer>> indices;
    private Random rand;
    
    public L0381_RandomizedCollectionWithDuplicates() {
        nums = new ArrayList<>();
        indices = new HashMap<>();
        rand = new Random();
    }
    
    public boolean insert(int val) {
        indices.putIfAbsent(val, new HashSet<>());
        indices.get(val).add(nums.size());
        nums.add(val);
        return indices.get(val).size() == 1;
    }
    
    public boolean remove(int val) {
        if (!indices.containsKey(val) || indices.get(val).isEmpty()) {
            return false;
        }
        
        int index = indices.get(val).iterator().next();
        int lastNum = nums.get(nums.size() - 1);
        
        nums.set(index, lastNum);
        indices.get(val).remove(index);
        if (indices.get(val).isEmpty()) {
            indices.remove(val);
        }
        
        if (index != nums.size() - 1) {
            indices.get(lastNum).remove(nums.size() - 1);
            indices.get(lastNum).add(index);
        }
        
        nums.remove(nums.size() - 1);
        return true;
    }
    
    public int getRandom() {
        return nums.get(rand.nextInt(nums.size()));
    }
}
```

---

## å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼šæ‰€æœ‰æ“ä½œå‡ä¸º O(1)
  - insertï¼šArrayList çš„æ·»åŠ å’Œ HashSet çš„æ·»åŠ éƒ½æ˜¯ O(1)
  - removeï¼šHashSet çš„æŸ¥æ‰¾ã€åˆ é™¤å’Œ ArrayList çš„ä¿®æ”¹éƒ½æ˜¯ O(1)
  - getRandomï¼šArrayList çš„éšæœºè®¿é—®æ˜¯ O(1)

- **ç©ºé—´å¤æ‚åº¦**ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯å…ƒç´ çš„æ€»æ•°ï¼ˆåŒ…æ‹¬é‡å¤å…ƒç´ ï¼‰
  - ArrayList å­˜å‚¨æ‰€æœ‰å…ƒç´ ï¼šO(n)
  - HashMap å­˜å‚¨æ‰€æœ‰ç´¢å¼•ï¼šO(n)

---

## LeetCode é¢˜è§£

æœ¬é¢˜è§£æ˜¯ LeetCode ç³»åˆ—é¢˜è§£çš„ä¸€éƒ¨åˆ†ã€‚è¯¥ç³»åˆ—é¢˜è§£è‡´åŠ›äºå¸®åŠ©ç¨‹åºå‘˜æ›´å¥½åœ°ç†è§£å’ŒæŒæ¡ç®—æ³•æ€ç»´ï¼Œå†…å®¹åŒ…å«è¯¦ç»†çš„è§£é¢˜æ€è·¯åˆ†æã€å›¾æ–‡å¹¶èŒ‚çš„ç¤ºä¾‹è®²è§£å’Œå®Œæ•´çš„ä»£ç å®ç°ã€‚

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode æœ€å…¨é¢˜è§£](https://github.com/LjyYano/LeetCode)ï¼šæŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿ Star â­ï¸ å…³æ³¨ï¼Œä¸€èµ·æ¢è®¨ç®—æ³•ä¹‹ç¾ã€‚ 
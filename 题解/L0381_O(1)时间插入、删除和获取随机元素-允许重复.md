---
title: O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´  - å…è®¸é‡å¤
date: 2024-03-27
---

## é¢˜ç›®æè¿°

**ğŸ”— é¢˜ç›®**ï¼š[O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´  - å…è®¸é‡å¤](https://leetcode.cn/problems/insert-delete-getrandom-o1-duplicates-allowed/)  
**ğŸ·ï¸ æ ‡ç­¾**ï¼š`è®¾è®¡` `æ•°ç»„` `å“ˆå¸Œè¡¨` `æ•°å­¦` `éšæœºåŒ–`  
**ğŸŸ¡ éš¾åº¦**ï¼š`ä¸­ç­‰`  

RandomizedCollection æ˜¯ä¸€ä¸ªåŒ…å«æ•°å­—é›†åˆ(å¯èƒ½æ˜¯é‡å¤çš„)çš„æ•°æ®ç»“æ„ã€‚å®ƒåº”è¯¥æ”¯æŒæ’å…¥å’Œåˆ é™¤ç‰¹å®šå…ƒç´ ï¼Œä»¥åŠåˆ é™¤éšæœºå…ƒç´ ã€‚

å®ç° RandomizedCollection ç±»:
- RandomizedCollection() åˆå§‹åŒ–ç©ºçš„ RandomizedCollection å¯¹è±¡
- bool insert(int val) å°†ä¸€ä¸ª val é¡¹æ’å…¥åˆ°é›†åˆä¸­ï¼Œå³ä½¿è¯¥é¡¹å·²ç»å­˜åœ¨ã€‚å¦‚æœè¯¥é¡¹ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› true ï¼Œå¦åˆ™è¿”å› false ã€‚
- bool remove(int val) å¦‚æœå­˜åœ¨ï¼Œä»é›†åˆä¸­ç§»é™¤ä¸€ä¸ª val é¡¹ã€‚å¦‚æœè¯¥é¡¹å­˜åœ¨ï¼Œåˆ™è¿”å› true ï¼Œå¦åˆ™è¿”å› false ã€‚æ³¨æ„ï¼Œå¦‚æœ val åœ¨é›†åˆä¸­å‡ºç°å¤šæ¬¡ï¼Œæˆ‘ä»¬åªåˆ é™¤å…¶ä¸­ä¸€ä¸ªã€‚
- int getRandom() ä»å½“å‰çš„å¤šä¸ªå…ƒç´ é›†åˆä¸­è¿”å›ä¸€ä¸ªéšæœºå…ƒç´ ã€‚æ¯ä¸ªå…ƒç´ è¢«è¿”å›çš„æ¦‚ç‡ä¸é›†åˆä¸­è¯¥å…ƒç´ çš„æ•°é‡å‘ˆçº¿æ€§ç›¸å…³ã€‚

ä½ å¿…é¡»å®ç°ç±»çš„æ‰€æœ‰å‡½æ•°ï¼Œå¹¶æ»¡è¶³æ¯ä¸ªå‡½æ•°çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(1) ã€‚

ç¤ºä¾‹ï¼š
```
è¾“å…¥
["RandomizedCollection", "insert", "insert", "insert", "getRandom", "remove", "getRandom"]
[[], [1], [1], [2], [], [1], []]
è¾“å‡º
[null, true, false, true, 2, true, 1]

è§£é‡Š
RandomizedCollection collection = new RandomizedCollection();// åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„é›†åˆ
collection.insert(1);   // è¿”å› trueï¼Œå› ä¸ºé›†åˆä¸åŒ…å« 1
                       // å°† 1 æ’å…¥åˆ°é›†åˆä¸­
collection.insert(1);   // è¿”å› falseï¼Œå› ä¸ºé›†åˆåŒ…å« 1
                       // å°†å¦ä¸€ä¸ª 1 æ’å…¥åˆ°é›†åˆä¸­
                       // é›†åˆç°åœ¨åŒ…å« [1,1]
collection.insert(2);   // è¿”å› trueï¼Œå› ä¸ºé›†åˆä¸åŒ…å« 2
                       // å°† 2 æ’å…¥åˆ°é›†åˆä¸­
                       // é›†åˆç°åœ¨åŒ…å« [1,1,2]
collection.getRandom(); // getRandom åº”å½“:
                       // æœ‰ 2/3 çš„æ¦‚ç‡è¿”å› 1
                       // æœ‰ 1/3 çš„æ¦‚ç‡è¿”å› 2
collection.remove(1);   // è¿”å› trueï¼Œå› ä¸ºé›†åˆåŒ…å« 1
                       // ä»é›†åˆä¸­ç§»é™¤ 1
                       // é›†åˆç°åœ¨åŒ…å« [1,2]
collection.getRandom(); // getRandom åº”å½“:
                       // æœ‰ 1/2 çš„æ¦‚ç‡è¿”å› 1
                       // æœ‰ 1/2 çš„æ¦‚ç‡è¿”å› 2
```

æç¤ºï¼š
* -2Â³Â¹ <= val <= 2Â³Â¹ - 1
* insert, remove å’Œ getRandom æœ€å¤š æ€»å…± è¢«è°ƒç”¨ 2 * 10âµ æ¬¡
* å½“è°ƒç”¨ getRandom æ—¶ï¼Œæ•°æ®ç»“æ„ä¸­ è‡³å°‘æœ‰ä¸€ä¸ª å…ƒç´ 

---

## è§£é¢˜æ€è·¯
### æ•°ç»„ + å“ˆå¸Œè¡¨è§£æ³•

#### ğŸ“ æ ¸å¿ƒæ€æƒ³
1. ä½¿ç”¨ ArrayList å­˜å‚¨æ‰€æœ‰å…ƒç´ ï¼ŒåŒ…æ‹¬é‡å¤å…ƒç´ ï¼Œè¿™æ ·å¯ä»¥å®ç° O(1) æ—¶é—´çš„éšæœºè®¿é—®
2. ä½¿ç”¨ HashMap<Integer, Set<Integer>> å­˜å‚¨æ¯ä¸ªå…ƒç´ çš„æ‰€æœ‰ç´¢å¼•ä½ç½®ï¼Œè¿™æ ·å¯ä»¥å®ç° O(1) æ—¶é—´çš„æ’å…¥å’Œåˆ é™¤
3. åˆ é™¤å…ƒç´ æ—¶ï¼Œå°†æœ€åä¸€ä¸ªå…ƒç´ ç§»åŠ¨åˆ°è¢«åˆ é™¤å…ƒç´ çš„ä½ç½®ï¼Œè¿™æ ·å¯ä»¥ä¿æŒæ•°ç»„çš„è¿ç»­æ€§

#### ğŸ› ï¸ å®ç°æ­¥éª¤
1. åˆå§‹åŒ–ï¼š
   - ArrayList ç”¨äºå­˜å‚¨å…ƒç´ 
   - HashMap<Integer, Set<Integer>> ç”¨äºå­˜å‚¨æ¯ä¸ªå…ƒç´ çš„æ‰€æœ‰ç´¢å¼•
   - Random å¯¹è±¡ç”¨äºç”Ÿæˆéšæœºæ•°

2. æ’å…¥æ“ä½œï¼ˆinsertï¼‰ï¼š
   - å°†å…ƒç´ æ·»åŠ åˆ° ArrayList çš„æœ«å°¾
   - åœ¨ HashMap ä¸­æ·»åŠ æ–°çš„ç´¢å¼•
   - å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ’å…¥è¯¥å…ƒç´ ï¼Œè¿”å› trueï¼›å¦åˆ™è¿”å› false

3. åˆ é™¤æ“ä½œï¼ˆremoveï¼‰ï¼š
   - ä» HashMap ä¸­è·å–è¦åˆ é™¤å…ƒç´ çš„ä¸€ä¸ªç´¢å¼•
   - å°†æœ€åä¸€ä¸ªå…ƒç´ ç§»åŠ¨åˆ°è¯¥ç´¢å¼•ä½ç½®
   - æ›´æ–° HashMap ä¸­çš„ç´¢å¼•ä¿¡æ¯
   - åˆ é™¤ ArrayList çš„æœ€åä¸€ä¸ªå…ƒç´ 

4. éšæœºè·å–ï¼ˆgetRandomï¼‰ï¼š
   - ä½¿ç”¨ Random å¯¹è±¡ç”Ÿæˆä¸€ä¸ªéšæœºç´¢å¼•
   - è¿”å›è¯¥ç´¢å¼•ä½ç½®çš„å…ƒç´ 

#### ğŸ§© ç¤ºä¾‹åˆ†æ
ä»¥ç¤ºä¾‹è¾“å…¥åºåˆ—ä¸ºä¾‹ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ•°æ®ç»“æ„çš„å˜åŒ–è¿‡ç¨‹ï¼š

1. åˆå§‹çŠ¶æ€ï¼š
```
ArrayList: []
HashMap: {}
```

2. æ’å…¥ 1ï¼š
```
ArrayList: [1]
HashMap: {1: {0}}
è¿”å›ï¼štrueï¼ˆé¦–æ¬¡æ’å…¥ï¼‰
```

3. å†æ¬¡æ’å…¥ 1ï¼š
```
ArrayList: [1, 1]
HashMap: {1: {0, 1}}
è¿”å›ï¼šfalseï¼ˆå·²å­˜åœ¨ï¼‰
```

4. æ’å…¥ 2ï¼š
```
ArrayList: [1, 1, 2]
HashMap: {1: {0, 1}, 2: {2}}
è¿”å›ï¼štrueï¼ˆé¦–æ¬¡æ’å…¥ï¼‰
```

5. åˆ é™¤ä¸€ä¸ª 1ï¼š
```
ArrayList: [1, 2]
HashMap: {1: {0}, 2: {1}}
è¿”å›ï¼štrueï¼ˆåˆ é™¤æˆåŠŸï¼‰
```

---

## ä»£ç å®ç°

å®Œæ•´çš„å¯è¿è¡Œä»£ç ï¼š[L0381_RandomizedCollectionWithDuplicates.java](../src/main/java/L0381_RandomizedCollectionWithDuplicates.java)

```java
public class L0381_RandomizedCollectionWithDuplicates {
    private List<Integer> nums;
    private Map<Integer, Set<Integer>> indices;
    private Random rand;
    
    public L0381_RandomizedCollectionWithDuplicates() {
        nums = new ArrayList<>();
        indices = new HashMap<>();
        rand = new Random();
    }
    
    public boolean insert(int val) {
        indices.putIfAbsent(val, new HashSet<>());
        indices.get(val).add(nums.size());
        nums.add(val);
        return indices.get(val).size() == 1;
    }
    
    public boolean remove(int val) {
        if (!indices.containsKey(val) || indices.get(val).isEmpty()) {
            return false;
        }
        
        int index = indices.get(val).iterator().next();
        int lastNum = nums.get(nums.size() - 1);
        
        nums.set(index, lastNum);
        indices.get(val).remove(index);
        
        Set<Integer> lastNumIndices = indices.get(lastNum);
        lastNumIndices.remove(nums.size() - 1);
        if (index < nums.size() - 1) {
            lastNumIndices.add(index);
        }
        
        nums.remove(nums.size() - 1);
        
        if (indices.get(val).isEmpty()) {
            indices.remove(val);
        }
        
        return true;
    }
    
    public int getRandom() {
        return nums.get(rand.nextInt(nums.size()));
    }
}
```

---

## å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š
  - insertï¼šO(1)ï¼ŒArrayList çš„æ·»åŠ æ“ä½œå’Œ HashMap çš„æ“ä½œéƒ½æ˜¯ O(1)
  - removeï¼šO(1)ï¼Œæ‰€æœ‰æ“ä½œï¼ˆåŒ…æ‹¬ HashSet çš„æ“ä½œï¼‰éƒ½æ˜¯ O(1)
  - getRandomï¼šO(1)ï¼ŒArrayList çš„éšæœºè®¿é—®æ˜¯ O(1)

- **ç©ºé—´å¤æ‚åº¦**ï¼šO(n)
  - ArrayList å­˜å‚¨æ‰€æœ‰å…ƒç´ ï¼šO(n)
  - HashMap å­˜å‚¨æ‰€æœ‰å…ƒç´ çš„ç´¢å¼•ï¼šO(n)
  - å…¶ä¸­ n æ˜¯å…ƒç´ çš„æ€»æ•°ï¼ˆåŒ…æ‹¬é‡å¤å…ƒç´ ï¼‰

---

## LeetCode é¢˜è§£

æœ¬é¢˜è§£æ˜¯ LeetCode ç³»åˆ—é¢˜è§£çš„ä¸€éƒ¨åˆ†ã€‚è¯¥ç³»åˆ—é¢˜è§£è‡´åŠ›äºå¸®åŠ©ç¨‹åºå‘˜æ›´å¥½åœ°ç†è§£å’ŒæŒæ¡ç®—æ³•æ€ç»´ï¼Œå†…å®¹åŒ…å«è¯¦ç»†çš„è§£é¢˜æ€è·¯åˆ†æã€å›¾æ–‡å¹¶èŒ‚çš„ç¤ºä¾‹è®²è§£å’Œå®Œæ•´çš„ä»£ç å®ç°ã€‚

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode æœ€å…¨é¢˜è§£](https://github.com/LjyYano/LeetCode)ï¼šæŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿ Star â­ï¸ å…³æ³¨ï¼Œä¸€èµ·æ¢è®¨ç®—æ³•ä¹‹ç¾ã€‚ 
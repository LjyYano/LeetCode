---
title: 比特位计数
date: 2024-03-24
---

## 题目描述

**🔗 题目**：[比特位计数](https://leetcode.cn/problems/counting-bits/)  
**🏷️ 标签**：`位运算` `动态规划`  
**🟡 难度**：`中等`  

给你一个整数 n ，对于 0 <= i <= n 中的每个 i ，计算其二进制表示中 1 的个数 ，返回一个长度为 n + 1 的数组 ans 作为答案。

示例 1：
```
输入：n = 2
输出：[0,1,1]
解释：
0 --> 0
1 --> 1
2 --> 10
```

示例 2：
```
输入：n = 5
输出：[0,1,1,2,1,2]
解释：
0 --> 0
1 --> 1
2 --> 10
3 --> 11
4 --> 100
5 --> 101
```

提示：
- 0 <= n <= 10⁵

进阶：
- 很容易就能实现时间复杂度为 O(n log n) 的解决方案，你可以在线性时间复杂度 O(n) 内用一趟扫描解决此问题吗？
- 你能不使用任何内置函数解决此问题吗？（如，C++ 中的 __builtin_popcount ）

---

## 解题思路

### 动态规划

#### 📝 核心思想

这道题可以使用动态规划来解决，关键是找到数字之间的关系。对于任意一个数字 n，我们可以观察到以下规律：

1. 如果 n 是偶数，那么 n 的二进制表示中 1 的个数与 n/2 相同
   - 因为偶数的二进制表示就是将其除以 2 的二进制表示左移一位（末尾补 0）
2. 如果 n 是奇数，那么 n 的二进制表示中 1 的个数比 n/2 多 1
   - 因为奇数的二进制表示就是将其除以 2 的二进制表示左移一位，再将最低位置为 1

#### 🛠️ 实现步骤

1. 创建一个长度为 n+1 的数组 dp，用于存储每个数字的二进制中 1 的个数
2. dp[0] = 0，因为 0 的二进制表示中没有 1
3. 对于 i > 0，有以下状态转移方程：
   - dp[i] = dp[i/2]，如果 i 是偶数
   - dp[i] = dp[i/2] + 1，如果 i 是奇数
4. 可以使用位运算优化：
   - i/2 可以用 i >> 1 表示
   - 判断奇偶可以用 i & 1

#### 🧩 示例分析

以 n = 5 为例，分析每个数字的计算过程：

| 数字 | 二进制 | 计算过程 | 1 的个数 |
|-----|--------|---------|---------|
| 0 | 0000 | 初始值 | 0 |
| 1 | 0001 | dp[1] = dp[0] + 1 | 1 |
| 2 | 0010 | dp[2] = dp[1] | 1 |
| 3 | 0011 | dp[3] = dp[1] + 1 | 2 |
| 4 | 0100 | dp[4] = dp[2] | 1 |
| 5 | 0101 | dp[5] = dp[2] + 1 | 2 |

可以看到：
- 对于偶数（2、4），其 1 的个数与其除以 2 后的数字相同
- 对于奇数（1、3、5），其 1 的个数比其除以 2 后的数字多 1

---

## 代码实现

完整的可运行代码：[L0338_CountingBits.java](../src/main/java/L0338_CountingBits.java)

```java
public int[] countBits(int n) {
    int[] ans = new int[n + 1];
    for (int i = 1; i <= n; i++) {
        // i >> 1 相当于 i/2
        // i & 1 相当于 i%2，用于判断奇偶性
        ans[i] = ans[i >> 1] + (i & 1);
    }
    return ans;
}
```

---

## 复杂度分析

- **时间复杂度**：O(n)
  - 我们只需要遍历一次从 1 到 n 的所有数字
  - 对每个数字的计算是 O(1) 的操作

- **空间复杂度**：O(1)
  - 除了存储答案的数组外，我们只使用了常数额外空间
  - 如果将答案数组的空间也计算在内，则空间复杂度为 O(n)

---

## LeetCode 题解

本题解是 LeetCode 系列题解的一部分。该系列题解致力于帮助程序员更好地理解和掌握算法思维，内容包含详细的解题思路分析、图文并茂的示例讲解和完整的代码实现。

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode 最全题解](https://github.com/LjyYano/LeetCode)：持续更新中，欢迎 Star ⭐️ 关注，一起探讨算法之美。 
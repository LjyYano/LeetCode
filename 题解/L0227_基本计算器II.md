---
title: 基本计算器 II
date: 2025-02-10
---

## 题目描述

**🔗 题目**：[基本计算器 II](https://leetcode.cn/problems/basic-calculator-ii/)  
**🏷️ 标签**：`栈` `数学` `字符串`  
**🟡 难度**：`中等`  

给你一个字符串表达式 s ，请你实现一个基本计算器来计算并返回它的值。
整数除法仅保留整数部分。
你可以假设给定的表达式总是有效的。所有中间结果将在 [-2³¹, 2³¹ - 1] 的范围内。
注意：不允许使用任何将字符串作为数学表达式计算的内置函数，比如 eval() 。

示例 1：
```
输入：s = "3+2*2"
输出：7
```

示例 2：
```
输入：s = " 3/2 "
输出：1
```

示例 3：
```
输入：s = " 3+5 / 2 "
输出：5
```

提示：
- 1 <= s.length <= 3 * 10⁵
- s 由整数和算符 ('+', '-', '*', '/') 组成，中间由一些空格隔开
- s 表示一个 有效表达式
- 表达式中的所有整数都是非负整数，且在范围 [0, 2³¹ - 1] 内
- 题目数据保证答案是一个 32 位整数

---

## 解题思路
### 栈实现

#### 📝 核心思想
本题的关键是处理运算符的优先级。乘除运算的优先级高于加减运算。我们可以使用栈来解决这个问题：
1. 遇到乘除运算时，直接与栈顶元素计算
2. 遇到加减运算时，将数字压入栈（减法转换为加上相反数）
3. 最后将栈中所有数字相加得到结果

这样就能保证乘除运算优先于加减运算执行。

#### 🛠️ 实现步骤
1. 初始化：
   - 创建一个栈用于存储数字
   - 记录当前数字 num
   - 记录上一个操作符 lastOp，初始为 '+'

2. 遍历字符串：
   - 如果是数字，累加到 num
   - 如果是操作符或最后一个字符：
     * 根据 lastOp 处理 num
     * 更新 lastOp 和 num

3. 根据操作符处理数字：
   - '+': 将数字压入栈
   - '-': 将数字的相反数压入栈
   - '*': 将数字与栈顶元素相乘，结果压入栈
   - '/': 将栈顶元素除以数字，结果压入栈

4. 计算最终结果：
   - 将栈中所有数字相加

#### 🧩 示例分析
以示例 1 `s = "3+2*2"` 为例：

| 步骤 | 当前字符 | num | lastOp | 栈内容 | 说明 |
|-----|---------|-----|--------|--------|------|
| 1 | '3' | 3 | '+' | [] | 读取数字 3 |
| 2 | '+' | 0 | '+' | [3] | 遇到 '+'，将 3 压入栈 |
| 3 | '2' | 2 | '+' | [3] | 读取数字 2 |
| 4 | '*' | 0 | '*' | [3,2] | 遇到 '*'，将 2 压入栈 |
| 5 | '2' | 2 | '*' | [3,2] | 读取数字 2 |
| 6 | 结束 | 0 | '*' | [3,4] | 计算 2*2=4，与栈顶元素运算 |
| 7 | 求和 | - | - | [7] | 计算最终结果 3+4=7 |

以示例 3 `s = " 3+5 / 2 "` 为例：

| 步骤 | 当前字符 | num | lastOp | 栈内容 | 说明 |
|-----|---------|-----|--------|--------|------|
| 1 | ' ' | 0 | '+' | [] | 跳过空格 |
| 2 | '3' | 3 | '+' | [] | 读取数字 3 |
| 3 | '+' | 0 | '+' | [3] | 遇到 '+'，将 3 压入栈 |
| 4 | '5' | 5 | '+' | [3] | 读取数字 5 |
| 5 | '/' | 0 | '/' | [3,5] | 遇到 '/'，将 5 压入栈 |
| 6 | '2' | 2 | '/' | [3,5] | 读取数字 2 |
| 7 | 结束 | 0 | '/' | [3,2] | 计算 5/2=2，与栈顶元素运算 |
| 8 | 求和 | - | - | [5] | 计算最终结果 3+2=5 |

---

## 代码实现

完整的可运行代码：[L0227_BasicCalculatorII.java](../src/main/java/L0227_BasicCalculatorII.java)

```java
public int calculate(String s) {
    Stack<Integer> stack = new Stack<>();
    int num = 0;
    char lastOp = '+';  // 上一个操作符，初始为 +
    
    for (int i = 0; i < s.length(); i++) {
        char c = s.charAt(i);
        
        // 如果是数字，累加到 num
        if (Character.isDigit(c)) {
            num = num * 10 + (c - '0');
        }
        
        // 如果是操作符或者是最后一个字符，处理前面的数字和操作符
        if ((!Character.isDigit(c) && c != ' ') || i == s.length() - 1) {
            // 根据上一个操作符处理当前数字
            switch (lastOp) {
                case '+':
                    stack.push(num);
                    break;
                case '-':
                    stack.push(-num);
                    break;
                case '*':
                    stack.push(stack.pop() * num);
                    break;
                case '/':
                    stack.push(stack.pop() / num);
                    break;
            }
            
            // 更新操作符和数字
            lastOp = c;
            num = 0;
        }
    }
    
    // 计算最终结果
    int result = 0;
    while (!stack.isEmpty()) {
        result += stack.pop();
    }
    
    return result;
}
```

---

## 复杂度分析

- **时间复杂度**：O(n)
  - 需要遍历字符串一次
  - 每个字符的处理时间是常数级别的
  - n 是字符串的长度

- **空间复杂度**：O(n)
  - 需要一个栈来存储中间结果
  - 在最坏情况下，栈的大小可能达到 O(n)

---

## LeetCode 题解

本题解是 LeetCode 系列题解的一部分。该系列题解致力于帮助程序员更好地理解和掌握算法思维，内容包含详细的解题思路分析、图文并茂的示例讲解和完整的代码实现。

<img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" width="20" style="vertical-align: middle; margin-right: 5px"> [LeetCode 最全题解](https://github.com/LjyYano/LeetCode)：持续更新中，欢迎 Star ⭐️ 关注，一起探讨算法之美。 